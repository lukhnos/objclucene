//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./sandbox/src/java/org/apache/lucene/sandbox/queries/FuzzyLikeThisQuery.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/lang/Float.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/HashMap.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "org/apache/lucene/analysis/Analyzer.h"
#include "org/apache/lucene/analysis/TokenStream.h"
#include "org/apache/lucene/analysis/tokenattributes/CharTermAttribute.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/IndexReaderContext.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/MultiFields.h"
#include "org/apache/lucene/index/Term.h"
#include "org/apache/lucene/index/TermContext.h"
#include "org/apache/lucene/index/TermState.h"
#include "org/apache/lucene/index/Terms.h"
#include "org/apache/lucene/index/TermsEnum.h"
#include "org/apache/lucene/sandbox/queries/FuzzyLikeThisQuery.h"
#include "org/apache/lucene/sandbox/queries/SlowFuzzyTermsEnum.h"
#include "org/apache/lucene/search/BooleanClause.h"
#include "org/apache/lucene/search/BooleanQuery.h"
#include "org/apache/lucene/search/BoostAttribute.h"
#include "org/apache/lucene/search/ConstantScoreQuery.h"
#include "org/apache/lucene/search/MaxNonCompetitiveBoostAttribute.h"
#include "org/apache/lucene/search/Query.h"
#include "org/apache/lucene/search/TermQuery.h"
#include "org/apache/lucene/search/similarities/DefaultSimilarity.h"
#include "org/apache/lucene/search/similarities/TFIDFSimilarity.h"
#include "org/apache/lucene/util/AttributeSource.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/PriorityQueue.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/sandbox/queries/FuzzyLikeThisQuery must not be compiled with ARC (-fobjc-arc)"
#endif

#pragma clang diagnostic ignored "-Wincomplete-implementation"

@interface OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery () {
 @public
  jint maxNumTerms_;
}

- (void)addTermsWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *)f;

- (OrgApacheLuceneSearchQuery *)newTermQueryWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                                                   withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term OBJC_METHOD_FAMILY_NONE;

@end

__attribute__((unused)) static void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f);

__attribute__((unused)) static OrgApacheLuceneSearchQuery *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term);

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)

OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim;

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery

+ (OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *)sim {
  return OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim;
}

+ (void)setSim:(OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *)value {
  JreStrongAssign(&OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim, value);
}

- (NSUInteger)hash {
  jint prime = 31;
  jint result = ((jint) [super hash]);
  result = prime * result + ((analyzer_ == nil) ? 0 : ((jint) [((OrgApacheLuceneAnalysisAnalyzer *) nil_chk(analyzer_)) hash]));
  result = prime * result + ((fieldVals_ == nil) ? 0 : ((jint) [((JavaUtilArrayList *) nil_chk(fieldVals_)) hash]));
  result = prime * result + (ignoreTF_ ? 1231 : 1237);
  result = prime * result + maxNumTerms_;
  return result;
}

- (jboolean)isEqual:(id)obj {
  if (JreObjectEqualsEquals(self, obj)) return true;
  if (obj == nil) return false;
  if (!JreObjectEqualsEquals([self java_getClass], [obj java_getClass])) return false;
  if (![super isEqual:obj]) {
    return false;
  }
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *other = (OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *) cast_chk(obj, [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery class]);
  if (analyzer_ == nil) {
    if (other->analyzer_ != nil) return false;
  }
  else if (![analyzer_ isEqual:other->analyzer_]) return false;
  if (fieldVals_ == nil) {
    if (other->fieldVals_ != nil) return false;
  }
  else if (![fieldVals_ isEqual:other->fieldVals_]) return false;
  if (ignoreTF_ != other->ignoreTF_) return false;
  if (maxNumTerms_ != other->maxNumTerms_) return false;
  return true;
}

- (instancetype)initWithInt:(jint)maxNumTerms
withOrgApacheLuceneAnalysisAnalyzer:(OrgApacheLuceneAnalysisAnalyzer *)analyzer {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(self, maxNumTerms, analyzer);
  return self;
}

- (void)addTermsWithNSString:(NSString *)queryString
                withNSString:(NSString *)fieldName
                   withFloat:(jfloat)minSimilarity
                     withInt:(jint)prefixLength {
  [((JavaUtilArrayList *) nil_chk(fieldVals_)) addWithId:create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(self, fieldName, minSimilarity, prefixLength, queryString)];
}

- (void)addTermsWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *)f {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(self, reader, f);
}

- (OrgApacheLuceneSearchQuery *)newTermQueryWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                                                   withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term {
  return OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, term);
}

- (OrgApacheLuceneSearchQuery *)rewriteWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader {
  if (rewrittenQuery_ != nil) {
    return rewrittenQuery_;
  }
  for (id<JavaUtilIterator> iter = JreRetainedLocalValue([((JavaUtilArrayList *) nil_chk(fieldVals_)) iterator]); [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f = JreRetainedLocalValue([iter next]);
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(self, reader, f);
  }
  [((JavaUtilArrayList *) nil_chk(fieldVals_)) clear];
  OrgApacheLuceneSearchBooleanQuery_Builder *bq = create_OrgApacheLuceneSearchBooleanQuery_Builder_init();
  JavaUtilHashMap *variantQueries = create_JavaUtilHashMap_init();
  jint size = [((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *) nil_chk(q_)) size];
  for (jint i = 0; i < size; i++) {
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = JreRetainedLocalValue([((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *) nil_chk(q_)) pop]);
    JavaUtilArrayList *l = JreRetainedLocalValue([variantQueries getWithId:((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->fuzziedSourceTerm_]);
    if (l == nil) {
      l = create_JavaUtilArrayList_init();
      [variantQueries putWithId:st->fuzziedSourceTerm_ withId:l];
    }
    [l addWithId:st];
  }
  for (id<JavaUtilIterator> iter = JreRetainedLocalValue([((id<JavaUtilCollection>) nil_chk([variantQueries values])) iterator]); [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
    JavaUtilArrayList *variants = JreRetainedLocalValue([iter next]);
    if ([((JavaUtilArrayList *) nil_chk(variants)) size] == 1) {
      OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = JreRetainedLocalValue([variants getWithInt:0]);
      OrgApacheLuceneSearchQuery *tq = OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->term_);
      [((OrgApacheLuceneSearchQuery *) nil_chk(tq)) setBoostWithFloat:st->score_];
      [bq addWithOrgApacheLuceneSearchQuery:tq withOrgApacheLuceneSearchBooleanClause_Occur:JreLoadEnum(OrgApacheLuceneSearchBooleanClause_Occur, SHOULD)];
    }
    else {
      OrgApacheLuceneSearchBooleanQuery_Builder *termVariants = create_OrgApacheLuceneSearchBooleanQuery_Builder_init();
      [termVariants setDisableCoordWithBoolean:true];
      for (id<JavaUtilIterator> iterator2 = JreRetainedLocalValue([variants iterator]); [((id<JavaUtilIterator>) nil_chk(iterator2)) hasNext]; ) {
        OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = JreRetainedLocalValue([iterator2 next]);
        OrgApacheLuceneSearchQuery *tq = OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->term_);
        [((OrgApacheLuceneSearchQuery *) nil_chk(tq)) setBoostWithFloat:st->score_];
        [termVariants addWithOrgApacheLuceneSearchQuery:tq withOrgApacheLuceneSearchBooleanClause_Occur:JreLoadEnum(OrgApacheLuceneSearchBooleanClause_Occur, SHOULD)];
      }
      [bq addWithOrgApacheLuceneSearchQuery:[termVariants build] withOrgApacheLuceneSearchBooleanClause_Occur:JreLoadEnum(OrgApacheLuceneSearchBooleanClause_Occur, SHOULD)];
    }
  }
  OrgApacheLuceneSearchQuery *q = JreRetainedLocalValue([bq build]);
  [((OrgApacheLuceneSearchQuery *) nil_chk(q)) setBoostWithFloat:[self getBoost]];
  JreStrongAssign(&self->rewrittenQuery_, q);
  return q;
}

- (NSString *)toStringWithNSString:(NSString *)field {
  return nil;
}

- (jboolean)isIgnoreTF {
  return ignoreTF_;
}

- (void)setIgnoreTFWithBoolean:(jboolean)ignoreTF {
  self->ignoreTF_ = ignoreTF;
}

- (void)dealloc {
  RELEASE_(rewrittenQuery_);
  RELEASE_(fieldVals_);
  RELEASE_(analyzer_);
  RELEASE_(q_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, "I", 0x1, 0, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 1, 2, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 4, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 4, 6, 7, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneSearchQuery;", 0x2, 8, 9, 7, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneSearchQuery;", 0x1, 10, 11, 7, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 12, 13, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 14, 15, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(hash);
  methods[1].selector = @selector(isEqual:);
  methods[2].selector = @selector(initWithInt:withOrgApacheLuceneAnalysisAnalyzer:);
  methods[3].selector = @selector(addTermsWithNSString:withNSString:withFloat:withInt:);
  methods[4].selector = @selector(addTermsWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:);
  methods[5].selector = @selector(newTermQueryWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneIndexTerm:);
  methods[6].selector = @selector(rewriteWithOrgApacheLuceneIndexIndexReader:);
  methods[7].selector = @selector(toStringWithNSString:);
  methods[8].selector = @selector(isIgnoreTF);
  methods[9].selector = @selector(setIgnoreTFWithBoolean:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "sim", "LOrgApacheLuceneSearchSimilaritiesTFIDFSimilarity;", .constantValue.asLong = 0, 0x8, -1, 16, -1, -1 },
    { "rewrittenQuery_", "LOrgApacheLuceneSearchQuery;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "fieldVals_", "LJavaUtilArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 17, -1 },
    { "analyzer_", "LOrgApacheLuceneAnalysisAnalyzer;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "q_", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "MAX_VARIANTS_PER_TERM_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "ignoreTF_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "maxNumTerms_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "hashCode", "equals", "LNSObject;", "ILOrgApacheLuceneAnalysisAnalyzer;", "addTerms", "LNSString;LNSString;FI", "LOrgApacheLuceneIndexIndexReader;LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals;", "LJavaIoIOException;", "newTermQuery", "LOrgApacheLuceneIndexIndexReader;LOrgApacheLuceneIndexTerm;", "rewrite", "LOrgApacheLuceneIndexIndexReader;", "toString", "LNSString;", "setIgnoreTF", "Z", &OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim, "Ljava/util/ArrayList<Lorg/apache/lucene/sandbox/queries/FuzzyLikeThisQuery$FieldVals;>;", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals;LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm;LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery = { "FuzzyLikeThisQuery", "org.apache.lucene.sandbox.queries", ptrTable, methods, fields, 7, 0x1, 10, 8, -1, 18, -1, -1, -1 };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim, new_OrgApacheLuceneSearchSimilaritiesDefaultSimilarity_init());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)
  }
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, jint maxNumTerms, OrgApacheLuceneAnalysisAnalyzer *analyzer) {
  OrgApacheLuceneSearchQuery_init(self);
  JreStrongAssign(&self->rewrittenQuery_, nil);
  JreStrongAssignAndConsume(&self->fieldVals_, new_JavaUtilArrayList_init());
  self->MAX_VARIANTS_PER_TERM_ = 50;
  self->ignoreTF_ = false;
  JreStrongAssignAndConsume(&self->q_, new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(maxNumTerms));
  JreStrongAssign(&self->analyzer_, analyzer);
  self->maxNumTerms_ = maxNumTerms;
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(jint maxNumTerms, OrgApacheLuceneAnalysisAnalyzer *analyzer) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery, initWithInt_withOrgApacheLuceneAnalysisAnalyzer_, maxNumTerms, analyzer)
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(jint maxNumTerms, OrgApacheLuceneAnalysisAnalyzer *analyzer) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery, initWithInt_withOrgApacheLuceneAnalysisAnalyzer_, maxNumTerms, analyzer)
}

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f) {
  if (((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *) nil_chk(f))->queryString_ == nil) return;
  OrgApacheLuceneIndexTerms *terms = OrgApacheLuceneIndexMultiFields_getTermsWithOrgApacheLuceneIndexIndexReader_withNSString_(reader, f->fieldName_);
  if (terms == nil) {
    return;
  }
  {
    OrgApacheLuceneAnalysisTokenStream *ts = [((OrgApacheLuceneAnalysisAnalyzer *) nil_chk(self->analyzer_)) tokenStreamWithNSString:f->fieldName_ withNSString:f->queryString_];
    JavaLangThrowable *__primaryException1 = nil;
    @try {
      id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute> termAtt = JreRetainedLocalValue([((OrgApacheLuceneAnalysisTokenStream *) nil_chk(ts)) addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesCharTermAttribute_class_()]);
      jint corpusNumDocs = [((OrgApacheLuceneIndexIndexReader *) nil_chk(reader)) numDocs];
      JavaUtilHashSet *processedTerms = create_JavaUtilHashSet_init();
      [ts reset];
      while ([ts incrementToken]) {
        NSString *term = [((id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute>) nil_chk(termAtt)) description];
        if (![processedTerms containsWithId:term]) {
          [processedTerms addWithId:term];
          OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *variantsQ = create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(self->MAX_VARIANTS_PER_TERM_);
          jfloat minScore = 0;
          OrgApacheLuceneIndexTerm *startTerm = create_OrgApacheLuceneIndexTerm_initWithNSString_withNSString_(f->fieldName_, term);
          OrgApacheLuceneUtilAttributeSource *atts = create_OrgApacheLuceneUtilAttributeSource_init();
          id<OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute> maxBoostAtt = JreRetainedLocalValue([atts addAttributeWithIOSClass:OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute_class_()]);
          OrgApacheLuceneSandboxQueriesSlowFuzzyTermsEnum *fe = create_OrgApacheLuceneSandboxQueriesSlowFuzzyTermsEnum_initWithOrgApacheLuceneIndexTerms_withOrgApacheLuceneUtilAttributeSource_withOrgApacheLuceneIndexTerm_withFloat_withInt_(terms, atts, startTerm, f->minSimilarity_, f->prefixLength_);
          jint df = [reader docFreqWithOrgApacheLuceneIndexTerm:startTerm];
          jint numVariants = 0;
          jint totalVariantDocFreqs = 0;
          OrgApacheLuceneUtilBytesRef *possibleMatch;
          id<OrgApacheLuceneSearchBoostAttribute> boostAtt = JreRetainedLocalValue([((OrgApacheLuceneUtilAttributeSource *) nil_chk([fe attributes])) addAttributeWithIOSClass:OrgApacheLuceneSearchBoostAttribute_class_()]);
          while ((possibleMatch = [fe next]) != nil) {
            numVariants++;
            totalVariantDocFreqs += [fe docFreq];
            jfloat score = [((id<OrgApacheLuceneSearchBoostAttribute>) nil_chk(boostAtt)) getBoost];
            if ([variantsQ size] < self->MAX_VARIANTS_PER_TERM_ || score > minScore) {
              OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(create_OrgApacheLuceneIndexTerm_initWithNSString_withOrgApacheLuceneUtilBytesRef_([startTerm field], OrgApacheLuceneUtilBytesRef_deepCopyOfWithOrgApacheLuceneUtilBytesRef_(possibleMatch)), score, startTerm);
              [variantsQ insertWithOverflowWithId:st];
              minScore = ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk([variantsQ top]))->score_;
            }
            [((id<OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute>) nil_chk(maxBoostAtt)) setMaxNonCompetitiveBoostWithFloat:[variantsQ size] >= self->MAX_VARIANTS_PER_TERM_ ? minScore : JavaLangFloat_NEGATIVE_INFINITY];
          }
          if (numVariants > 0) {
            jint avgDf = JreIntDiv(totalVariantDocFreqs, numVariants);
            if (df == 0) {
              df = avgDf;
            }
            jint size = [variantsQ size];
            for (jint i = 0; i < size; i++) {
              OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = JreRetainedLocalValue([variantsQ pop]);
              ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->score_ = (st->score_ * st->score_) * [((OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *) nil_chk(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim)) idfWithLong:df withLong:corpusNumDocs];
              [((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *) nil_chk(self->q_)) insertWithOverflowWithId:st];
            }
          }
        }
      }
      [ts end];
    }
    @catch (JavaLangThrowable *e) {
      __primaryException1 = e;
      @throw e;
    }
    @finally {
      if (ts != nil) {
        if (__primaryException1 != nil) {
          @try {
            [ts close];
          }
          @catch (JavaLangThrowable *e) {
            [__primaryException1 addSuppressedWithJavaLangThrowable:e];
          }
        }
        else {
          [ts close];
        }
      }
    }
  }
}

OrgApacheLuceneSearchQuery *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term) {
  if (self->ignoreTF_) {
    return create_OrgApacheLuceneSearchConstantScoreQuery_initWithOrgApacheLuceneSearchQuery_(create_OrgApacheLuceneSearchTermQuery_initWithOrgApacheLuceneIndexTerm_(term));
  }
  else {
    OrgApacheLuceneIndexTermContext *context = create_OrgApacheLuceneIndexTermContext_initWithOrgApacheLuceneIndexIndexReaderContext_([((OrgApacheLuceneIndexIndexReader *) nil_chk(reader)) getContext]);
    for (OrgApacheLuceneIndexLeafReaderContext * __strong leafContext in nil_chk([reader leaves])) {
      OrgApacheLuceneIndexTerms *terms = JreRetainedLocalValue([((OrgApacheLuceneIndexLeafReader *) nil_chk([((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(leafContext)) reader])) termsWithNSString:[((OrgApacheLuceneIndexTerm *) nil_chk(term)) field]]);
      if (terms != nil) {
        OrgApacheLuceneIndexTermsEnum *termsEnum = JreRetainedLocalValue([terms iterator]);
        if ([((OrgApacheLuceneIndexTermsEnum *) nil_chk(termsEnum)) seekExactWithOrgApacheLuceneUtilBytesRef:[term bytes]]) {
          jint freq = 1 - [context docFreq];
          [context register__WithOrgApacheLuceneIndexTermState:[termsEnum termState] withInt:leafContext->ord_ withInt:freq withLong:freq];
        }
      }
    }
    return create_OrgApacheLuceneSearchTermQuery_initWithOrgApacheLuceneIndexTerm_withOrgApacheLuceneIndexTermContext_(term, context);
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals

- (instancetype)initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *)outer$
                                                           withNSString:(NSString *)name
                                                              withFloat:(jfloat)similarity
                                                                withInt:(jint)length
                                                           withNSString:(NSString *)queryString {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(self, outer$, name, similarity, length, queryString);
  return self;
}

- (NSUInteger)hash {
  jint prime = 31;
  jint result = 1;
  result = prime * result + ((fieldName_ == nil) ? 0 : ((jint) [((NSString *) nil_chk(fieldName_)) hash]));
  result = prime * result + JavaLangFloat_floatToIntBitsWithFloat_(minSimilarity_);
  result = prime * result + prefixLength_;
  result = prime * result + ((queryString_ == nil) ? 0 : ((jint) [((NSString *) nil_chk(queryString_)) hash]));
  return result;
}

- (jboolean)isEqual:(id)obj {
  if (JreObjectEqualsEquals(self, obj)) return true;
  if (obj == nil) return false;
  if (!JreObjectEqualsEquals([self java_getClass], [obj java_getClass])) return false;
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *other = (OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *) cast_chk(obj, [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals class]);
  if (fieldName_ == nil) {
    if (other->fieldName_ != nil) return false;
  }
  else if (![fieldName_ isEqual:other->fieldName_]) return false;
  if (JavaLangFloat_floatToIntBitsWithFloat_(minSimilarity_) != JavaLangFloat_floatToIntBitsWithFloat_(other->minSimilarity_)) return false;
  if (prefixLength_ != other->prefixLength_) return false;
  if (queryString_ == nil) {
    if (other->queryString_ != nil) return false;
  }
  else if (![queryString_ isEqual:other->queryString_]) return false;
  return true;
}

- (void)dealloc {
  RELEASE_(queryString_);
  RELEASE_(fieldName_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 2, 3, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery:withNSString:withFloat:withInt:withNSString:);
  methods[1].selector = @selector(hash);
  methods[2].selector = @selector(isEqual:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "queryString_", "LNSString;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "fieldName_", "LNSString;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "minSimilarity_", "F", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "prefixLength_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;LNSString;FILNSString;", "hashCode", "equals", "LNSObject;", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals = { "FieldVals", "org.apache.lucene.sandbox.queries", ptrTable, methods, fields, 7, 0x0, 3, 4, 4, -1, -1, -1, -1 };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *self, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *outer$, NSString *name, jfloat similarity, jint length, NSString *queryString) {
  NSObject_init(self);
  JreStrongAssign(&self->fieldName_, name);
  self->minSimilarity_ = similarity;
  self->prefixLength_ = length;
  JreStrongAssign(&self->queryString_, queryString);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *outer$, NSString *name, jfloat similarity, jint length, NSString *queryString) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals, initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_, outer$, name, similarity, length, queryString)
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *outer$, NSString *name, jfloat similarity, jint length, NSString *queryString) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals, initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_, outer$, name, similarity, length, queryString)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm

- (instancetype)initWithOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term
                                       withFloat:(jfloat)score
                    withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)fuzziedSourceTerm {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(self, term, score, fuzziedSourceTerm);
  return self;
}

- (void)dealloc {
  RELEASE_(term_);
  RELEASE_(fuzziedSourceTerm_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneIndexTerm:withFloat:withOrgApacheLuceneIndexTerm:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "term_", "LOrgApacheLuceneIndexTerm;", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "score_", "F", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "fuzziedSourceTerm_", "LOrgApacheLuceneIndexTerm;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneIndexTerm;FLOrgApacheLuceneIndexTerm;", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm = { "ScoreTerm", "org.apache.lucene.sandbox.queries", ptrTable, methods, fields, 7, 0xa, 1, 3, 1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *self, OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) {
  NSObject_init(self);
  JreStrongAssign(&self->term_, term);
  self->score_ = score;
  JreStrongAssign(&self->fuzziedSourceTerm_, fuzziedSourceTerm);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm, initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_, term, score, fuzziedSourceTerm)
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm, initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_, term, score, fuzziedSourceTerm)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue

- (instancetype)initWithInt:(jint)size {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(self, size);
  return self;
}

- (jboolean)lessThanWithId:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *)termA
                    withId:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *)termB {
  if (((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(termA))->score_ == ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(termB))->score_) return [((OrgApacheLuceneIndexTerm *) nil_chk(termA->term_)) compareToWithId:termB->term_] > 0;
  else return termA->score_ < termB->score_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x4, 1, 2, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithInt:);
  methods[1].selector = @selector(lessThanWithId:withId:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "I", "lessThan", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm;LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm;", "LOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;", "Lorg/apache/lucene/util/PriorityQueue<Lorg/apache/lucene/sandbox/queries/FuzzyLikeThisQuery$ScoreTerm;>;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue = { "ScoreTermQueue", "org.apache.lucene.sandbox.queries", ptrTable, methods, NULL, 7, 0xa, 2, 0, 3, -1, -1, 4, -1 };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *self, jint size) {
  OrgApacheLuceneUtilPriorityQueue_initWithInt_(self, size);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(jint size) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue, initWithInt_, size)
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *create_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(jint size) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue, initWithInt_, size)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue)
