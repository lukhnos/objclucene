//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/CapitalizationFilter.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Character.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/System.h"
#include "java/util/Collection.h"
#include "org/apache/lucene/analysis/TokenFilter.h"
#include "org/apache/lucene/analysis/TokenStream.h"
#include "org/apache/lucene/analysis/miscellaneous/CapitalizationFilter.h"
#include "org/apache/lucene/analysis/tokenattributes/CharTermAttribute.h"
#include "org/apache/lucene/analysis/util/CharArraySet.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/analysis/miscellaneous/CapitalizationFilter must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter () {
 @public
  jboolean onlyFirstWord_;
  OrgApacheLuceneAnalysisUtilCharArraySet *keep_;
  jboolean forceFirstLetter_;
  id<JavaUtilCollection> okPrefix_;
  jint minWordLength_;
  jint maxWordCount_;
  jint maxTokenLength_;
  id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute> termAtt_;
}

- (void)processWordWithCharArray:(IOSCharArray *)buffer
                         withInt:(jint)offset
                         withInt:(jint)length
                         withInt:(jint)wordCount;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, keep_, OrgApacheLuceneAnalysisUtilCharArraySet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, okPrefix_, id<JavaUtilCollection>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, termAtt_, id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute>)

__attribute__((unused)) static void OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_processWordWithCharArray_withInt_withInt_withInt_(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *self, IOSCharArray *buffer, jint offset, jint length, jint wordCount);

@implementation OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter

+ (jint)DEFAULT_MAX_WORD_COUNT {
  return OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_WORD_COUNT;
}

+ (jint)DEFAULT_MAX_TOKEN_LENGTH {
  return OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_TOKEN_LENGTH;
}

- (instancetype)initWithOrgApacheLuceneAnalysisTokenStream:(OrgApacheLuceneAnalysisTokenStream *)inArg {
  OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_(self, inArg);
  return self;
}

- (instancetype)initWithOrgApacheLuceneAnalysisTokenStream:(OrgApacheLuceneAnalysisTokenStream *)inArg
                                               withBoolean:(jboolean)onlyFirstWord
               withOrgApacheLuceneAnalysisUtilCharArraySet:(OrgApacheLuceneAnalysisUtilCharArraySet *)keep
                                               withBoolean:(jboolean)forceFirstLetter
                                    withJavaUtilCollection:(id<JavaUtilCollection>)okPrefix
                                                   withInt:(jint)minWordLength
                                                   withInt:(jint)maxWordCount
                                                   withInt:(jint)maxTokenLength {
  OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_(self, inArg, onlyFirstWord, keep, forceFirstLetter, okPrefix, minWordLength, maxWordCount, maxTokenLength);
  return self;
}

- (jboolean)incrementToken {
  if (![((OrgApacheLuceneAnalysisTokenStream *) nil_chk(input_)) incrementToken]) return false;
  IOSCharArray *termBuffer = [((id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute>) nil_chk(termAtt_)) buffer];
  jint termBufferLength = [termAtt_ java_length];
  IOSCharArray *backup = nil;
  if (maxWordCount_ < OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_WORD_COUNT) {
    backup = [IOSCharArray arrayWithLength:termBufferLength];
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(termBuffer, 0, backup, 0, termBufferLength);
  }
  if (termBufferLength < maxTokenLength_) {
    jint wordCount = 0;
    jint lastWordStart = 0;
    for (jint i = 0; i < termBufferLength; i++) {
      jchar c = IOSCharArray_Get(nil_chk(termBuffer), i);
      if (c <= ' ' || c == '.') {
        jint len = i - lastWordStart;
        if (len > 0) {
          OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_processWordWithCharArray_withInt_withInt_withInt_(self, termBuffer, lastWordStart, len, wordCount++);
          lastWordStart = i + 1;
          i++;
        }
      }
    }
    if (lastWordStart < termBufferLength) {
      OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_processWordWithCharArray_withInt_withInt_withInt_(self, termBuffer, lastWordStart, termBufferLength - lastWordStart, wordCount++);
    }
    if (wordCount > maxWordCount_) {
      [termAtt_ copyBufferWithCharArray:backup withInt:0 withInt:termBufferLength];
    }
  }
  return true;
}

- (void)processWordWithCharArray:(IOSCharArray *)buffer
                         withInt:(jint)offset
                         withInt:(jint)length
                         withInt:(jint)wordCount {
  OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_processWordWithCharArray_withInt_withInt_withInt_(self, buffer, offset, length, wordCount);
}

- (void)dealloc {
  RELEASE_(keep_);
  RELEASE_(okPrefix_);
  RELEASE_(termAtt_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, 2, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, 3, -1, -1, -1 },
    { NULL, "V", 0x2, 4, 5, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneAnalysisTokenStream:);
  methods[1].selector = @selector(initWithOrgApacheLuceneAnalysisTokenStream:withBoolean:withOrgApacheLuceneAnalysisUtilCharArraySet:withBoolean:withJavaUtilCollection:withInt:withInt:withInt:);
  methods[2].selector = @selector(incrementToken);
  methods[3].selector = @selector(processWordWithCharArray:withInt:withInt:withInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "DEFAULT_MAX_WORD_COUNT", "I", .constantValue.asInt = OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_WORD_COUNT, 0x19, -1, -1, -1, -1 },
    { "DEFAULT_MAX_TOKEN_LENGTH", "I", .constantValue.asInt = OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_TOKEN_LENGTH, 0x19, -1, -1, -1, -1 },
    { "onlyFirstWord_", "Z", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "keep_", "LOrgApacheLuceneAnalysisUtilCharArraySet;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "forceFirstLetter_", "Z", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "okPrefix_", "LJavaUtilCollection;", .constantValue.asLong = 0, 0x12, -1, -1, 6, -1 },
    { "minWordLength_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "maxWordCount_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "maxTokenLength_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "termAtt_", "LOrgApacheLuceneAnalysisTokenattributesCharTermAttribute;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneAnalysisTokenStream;", "LOrgApacheLuceneAnalysisTokenStream;ZLOrgApacheLuceneAnalysisUtilCharArraySet;ZLJavaUtilCollection;III", "(Lorg/apache/lucene/analysis/TokenStream;ZLorg/apache/lucene/analysis/util/CharArraySet;ZLjava/util/Collection<[C>;III)V", "LJavaIoIOException;", "processWord", "[CIII", "Ljava/util/Collection<[C>;" };
  static const J2ObjcClassInfo _OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter = { "CapitalizationFilter", "org.apache.lucene.analysis.miscellaneous", ptrTable, methods, fields, 7, 0x11, 4, 10, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter;
}

@end

void OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *self, OrgApacheLuceneAnalysisTokenStream *inArg) {
  OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_(self, inArg, true, nil, true, nil, 0, OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_WORD_COUNT, OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_DEFAULT_MAX_TOKEN_LENGTH);
}

OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *new_OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_(OrgApacheLuceneAnalysisTokenStream *inArg) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, initWithOrgApacheLuceneAnalysisTokenStream_, inArg)
}

OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *create_OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_(OrgApacheLuceneAnalysisTokenStream *inArg) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, initWithOrgApacheLuceneAnalysisTokenStream_, inArg)
}

void OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *self, OrgApacheLuceneAnalysisTokenStream *inArg, jboolean onlyFirstWord, OrgApacheLuceneAnalysisUtilCharArraySet *keep, jboolean forceFirstLetter, id<JavaUtilCollection> okPrefix, jint minWordLength, jint maxWordCount, jint maxTokenLength) {
  OrgApacheLuceneAnalysisTokenFilter_initWithOrgApacheLuceneAnalysisTokenStream_(self, inArg);
  JreStrongAssign(&self->termAtt_, [self addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesCharTermAttribute_class_()]);
  self->onlyFirstWord_ = onlyFirstWord;
  JreStrongAssign(&self->keep_, keep);
  self->forceFirstLetter_ = forceFirstLetter;
  JreStrongAssign(&self->okPrefix_, okPrefix);
  if (minWordLength < 0) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"minWordLength must be greater than or equal to zero");
  }
  if (maxWordCount < 1) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"maxWordCount must be greater than zero");
  }
  if (maxTokenLength < 1) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"maxTokenLength must be greater than zero");
  }
  self->minWordLength_ = minWordLength;
  self->maxWordCount_ = maxWordCount;
  self->maxTokenLength_ = maxTokenLength;
}

OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *new_OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_(OrgApacheLuceneAnalysisTokenStream *inArg, jboolean onlyFirstWord, OrgApacheLuceneAnalysisUtilCharArraySet *keep, jboolean forceFirstLetter, id<JavaUtilCollection> okPrefix, jint minWordLength, jint maxWordCount, jint maxTokenLength) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_, inArg, onlyFirstWord, keep, forceFirstLetter, okPrefix, minWordLength, maxWordCount, maxTokenLength)
}

OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *create_OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_(OrgApacheLuceneAnalysisTokenStream *inArg, jboolean onlyFirstWord, OrgApacheLuceneAnalysisUtilCharArraySet *keep, jboolean forceFirstLetter, id<JavaUtilCollection> okPrefix, jint minWordLength, jint maxWordCount, jint maxTokenLength) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter, initWithOrgApacheLuceneAnalysisTokenStream_withBoolean_withOrgApacheLuceneAnalysisUtilCharArraySet_withBoolean_withJavaUtilCollection_withInt_withInt_withInt_, inArg, onlyFirstWord, keep, forceFirstLetter, okPrefix, minWordLength, maxWordCount, maxTokenLength)
}

void OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter_processWordWithCharArray_withInt_withInt_withInt_(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter *self, IOSCharArray *buffer, jint offset, jint length, jint wordCount) {
  if (length < 1) {
    return;
  }
  if (self->onlyFirstWord_ && wordCount > 0) {
    for (jint i = 0; i < length; i++) {
      *IOSCharArray_GetRef(nil_chk(buffer), offset + i) = JavaLangCharacter_toLowerCaseWithChar_(IOSCharArray_Get(buffer, offset + i));
    }
    return;
  }
  if (self->keep_ != nil && [self->keep_ containsWithCharArray:buffer withInt:offset withInt:length]) {
    if (wordCount == 0 && self->forceFirstLetter_) {
      *IOSCharArray_GetRef(nil_chk(buffer), offset) = JavaLangCharacter_toUpperCaseWithChar_(IOSCharArray_Get(buffer, offset));
    }
    return;
  }
  if (length < self->minWordLength_) {
    return;
  }
  if (self->okPrefix_ != nil) {
    for (IOSCharArray * __strong prefix in self->okPrefix_) {
      if (length >= ((IOSCharArray *) nil_chk(prefix))->size_) {
        jboolean match = true;
        for (jint i = 0; i < prefix->size_; i++) {
          if (IOSCharArray_Get(prefix, i) != IOSCharArray_Get(nil_chk(buffer), offset + i)) {
            match = false;
            break;
          }
        }
        if (match == true) {
          return;
        }
      }
    }
  }
  *IOSCharArray_GetRef(nil_chk(buffer), offset) = JavaLangCharacter_toUpperCaseWithChar_(IOSCharArray_Get(buffer, offset));
  for (jint i = 1; i < length; i++) {
    *IOSCharArray_GetRef(buffer, offset + i) = JavaLangCharacter_toLowerCaseWithChar_(IOSCharArray_Get(buffer, offset + i));
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneAnalysisMiscellaneousCapitalizationFilter)
