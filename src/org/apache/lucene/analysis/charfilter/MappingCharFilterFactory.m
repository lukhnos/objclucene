//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./analysis/common/src/java/org/apache/lucene/analysis/charfilter/MappingCharFilterFactory.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Reader.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/regex/Matcher.h"
#include "java/util/regex/Pattern.h"
#include "org/apache/lucene/analysis/charfilter/MappingCharFilter.h"
#include "org/apache/lucene/analysis/charfilter/MappingCharFilterFactory.h"
#include "org/apache/lucene/analysis/charfilter/NormalizeCharMap.h"
#include "org/apache/lucene/analysis/util/AbstractAnalysisFactory.h"
#include "org/apache/lucene/analysis/util/CharFilterFactory.h"
#include "org/apache/lucene/analysis/util/ResourceLoader.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/analysis/charfilter/MappingCharFilterFactory must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory () {
 @public
  NSString *mapping_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory, mapping_, NSString *)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory)

JavaUtilRegexPattern *OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p;

@implementation OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory

+ (JavaUtilRegexPattern *)p {
  return OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p;
}

+ (void)setP:(JavaUtilRegexPattern *)value {
  JreStrongAssign(&OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p, value);
}

- (instancetype)initWithJavaUtilMap:(id<JavaUtilMap>)args {
  OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_initWithJavaUtilMap_(self, args);
  return self;
}

- (void)informWithOrgApacheLuceneAnalysisUtilResourceLoader:(id<OrgApacheLuceneAnalysisUtilResourceLoader>)loader {
  if (mapping_ != nil) {
    id<JavaUtilList> wlist = nil;
    id<JavaUtilList> files = JreRetainedLocalValue([self splitFileNamesWithNSString:mapping_]);
    wlist = create_JavaUtilArrayList_init();
    for (NSString * __strong file in nil_chk(files)) {
      id<JavaUtilList> lines = JreRetainedLocalValue([self getLinesWithOrgApacheLuceneAnalysisUtilResourceLoader:loader withNSString:[((NSString *) nil_chk(file)) java_trim]]);
      [wlist addAllWithJavaUtilCollection:lines];
    }
    OrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder *builder = create_OrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder_init();
    [self parseRulesWithJavaUtilList:wlist withOrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder:builder];
    JreStrongAssign(&normMap_, [builder build]);
    if (((OrgApacheLuceneAnalysisCharfilterNormalizeCharMap *) nil_chk(normMap_))->map_ == nil) {
      JreStrongAssign(&normMap_, nil);
    }
  }
}

- (JavaIoReader *)createWithJavaIoReader:(JavaIoReader *)input {
  return normMap_ == nil ? input : create_OrgApacheLuceneAnalysisCharfilterMappingCharFilter_initWithOrgApacheLuceneAnalysisCharfilterNormalizeCharMap_withJavaIoReader_(normMap_, input);
}

- (void)parseRulesWithJavaUtilList:(id<JavaUtilList>)rules
withOrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder:(OrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder *)builder {
  for (NSString * __strong rule in nil_chk(rules)) {
    JavaUtilRegexMatcher *m = JreRetainedLocalValue([((JavaUtilRegexPattern *) nil_chk(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p)) matcherWithJavaLangCharSequence:rule]);
    if (![((JavaUtilRegexMatcher *) nil_chk(m)) find]) @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$$$", @"Invalid Mapping Rule : [", rule, @"], file = ", mapping_));
    [((OrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder *) nil_chk(builder)) addWithNSString:[self parseStringWithNSString:[m groupWithInt:1]] withNSString:[self parseStringWithNSString:[m groupWithInt:2]]];
  }
}

- (NSString *)parseStringWithNSString:(NSString *)s {
  jint readPos = 0;
  jint len = [((NSString *) nil_chk(s)) java_length];
  jint writePos = 0;
  while (readPos < len) {
    jchar c = [s charAtWithInt:readPos++];
    if (c == '\\') {
      if (readPos >= len) @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$C", @"Invalid escaped char in [", s, ']'));
      c = [s charAtWithInt:readPos++];
      switch (c) {
        case '\\':
        c = '\\';
        break;
        case '"':
        c = '"';
        break;
        case 'n':
        c = 0x000a;
        break;
        case 't':
        c = 0x0009;
        break;
        case 'r':
        c = 0x000d;
        break;
        case 'b':
        c = 0x0008;
        break;
        case 'f':
        c = 0x000c;
        break;
        case 'u':
        if (readPos + 3 >= len) @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$C", @"Invalid escaped char in [", s, ']'));
        c = (jchar) JavaLangInteger_parseIntWithNSString_withInt_([s java_substring:readPos endIndex:readPos + 4], 16);
        readPos += 4;
        break;
      }
    }
    *IOSCharArray_GetRef(nil_chk(out_), writePos++) = c;
  }
  return [NSString java_stringWithCharacters:out_ offset:0 length:writePos];
}

- (OrgApacheLuceneAnalysisUtilAbstractAnalysisFactory *)getMultiTermComponent {
  return self;
}

- (void)dealloc {
  RELEASE_(normMap_);
  RELEASE_(mapping_);
  RELEASE_(out_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, 1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, 4, -1, -1, -1 },
    { NULL, "LJavaIoReader;", 0x1, 5, 6, -1, -1, -1, -1 },
    { NULL, "V", 0x4, 7, 8, -1, 9, -1, -1 },
    { NULL, "LNSString;", 0x4, 10, 11, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneAnalysisUtilAbstractAnalysisFactory;", 0x1, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithJavaUtilMap:);
  methods[1].selector = @selector(informWithOrgApacheLuceneAnalysisUtilResourceLoader:);
  methods[2].selector = @selector(createWithJavaIoReader:);
  methods[3].selector = @selector(parseRulesWithJavaUtilList:withOrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder:);
  methods[4].selector = @selector(parseStringWithNSString:);
  methods[5].selector = @selector(getMultiTermComponent);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "normMap_", "LOrgApacheLuceneAnalysisCharfilterNormalizeCharMap;", .constantValue.asLong = 0, 0x4, -1, -1, -1, -1 },
    { "mapping_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "p", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x8, -1, 12, -1, -1 },
    { "out_", "[C", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LJavaUtilMap;", "(Ljava/util/Map<Ljava/lang/String;Ljava/lang/String;>;)V", "inform", "LOrgApacheLuceneAnalysisUtilResourceLoader;", "LJavaIoIOException;", "create", "LJavaIoReader;", "parseRules", "LJavaUtilList;LOrgApacheLuceneAnalysisCharfilterNormalizeCharMap_Builder;", "(Ljava/util/List<Ljava/lang/String;>;Lorg/apache/lucene/analysis/charfilter/NormalizeCharMap$Builder;)V", "parseString", "LNSString;", &OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p };
  static const J2ObjcClassInfo _OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory = { "MappingCharFilterFactory", "org.apache.lucene.analysis.charfilter", ptrTable, methods, fields, 7, 0x1, 6, 4, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory class]) {
    JreStrongAssign(&OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_p, JavaUtilRegexPattern_compileWithNSString_(@"\"(.*)\"\\s*=>\\s*\"(.*)\"\\s*$"));
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory)
  }
}

@end

void OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_initWithJavaUtilMap_(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory *self, id<JavaUtilMap> args) {
  OrgApacheLuceneAnalysisUtilCharFilterFactory_initWithJavaUtilMap_(self, args);
  JreStrongAssignAndConsume(&self->out_, [IOSCharArray newArrayWithLength:256]);
  JreStrongAssign(&self->mapping_, [self getWithJavaUtilMap:args withNSString:@"mapping"]);
  if (![((id<JavaUtilMap>) nil_chk(args)) isEmpty]) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$@", @"Unknown parameters: ", args));
  }
}

OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory *new_OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_initWithJavaUtilMap_(id<JavaUtilMap> args) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory, initWithJavaUtilMap_, args)
}

OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory *create_OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory_initWithJavaUtilMap_(id<JavaUtilMap> args) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory, initWithJavaUtilMap_, args)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneAnalysisCharfilterMappingCharFilterFactory)
