//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/search/SortRescorer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/Comparator.h"
#include "java/util/List.h"
#include "java/util/function/Function.h"
#include "java/util/function/ToDoubleFunction.h"
#include "java/util/function/ToIntFunction.h"
#include "java/util/function/ToLongFunction.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/search/Explanation.h"
#include "org/apache/lucene/search/FakeScorer.h"
#include "org/apache/lucene/search/FieldDoc.h"
#include "org/apache/lucene/search/IndexSearcher.h"
#include "org/apache/lucene/search/LeafCollector.h"
#include "org/apache/lucene/search/Rescorer.h"
#include "org/apache/lucene/search/ScoreDoc.h"
#include "org/apache/lucene/search/Sort.h"
#include "org/apache/lucene/search/SortField.h"
#include "org/apache/lucene/search/SortRescorer.h"
#include "org/apache/lucene/search/TopDocs.h"
#include "org/apache/lucene/search/TopFieldCollector.h"
#include "org/apache/lucene/search/TopFieldDocs.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/search/SortRescorer must not be compiled with ARC (-fobjc-arc)"
#endif

#pragma clang diagnostic ignored "-Wprotocol"

@interface OrgApacheLuceneSearchSortRescorer () {
 @public
  OrgApacheLuceneSearchSort *sort_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSortRescorer, sort_, OrgApacheLuceneSearchSort *)

@interface OrgApacheLuceneSearchSortRescorer_1 : NSObject < JavaUtilComparator >

- (instancetype)init;

- (jint)compareWithId:(OrgApacheLuceneSearchScoreDoc *)a
               withId:(OrgApacheLuceneSearchScoreDoc *)b;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchSortRescorer_1)

__attribute__((unused)) static void OrgApacheLuceneSearchSortRescorer_1_init(OrgApacheLuceneSearchSortRescorer_1 *self);

__attribute__((unused)) static OrgApacheLuceneSearchSortRescorer_1 *new_OrgApacheLuceneSearchSortRescorer_1_init(void) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneSearchSortRescorer_1 *create_OrgApacheLuceneSearchSortRescorer_1_init(void);

@implementation OrgApacheLuceneSearchSortRescorer

- (instancetype)initWithOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)sort {
  OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(self, sort);
  return self;
}

- (OrgApacheLuceneSearchTopDocs *)rescoreWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                               withOrgApacheLuceneSearchTopDocs:(OrgApacheLuceneSearchTopDocs *)firstPassTopDocs
                                                                        withInt:(jint)topN {
  IOSObjectArray *hits = [((IOSObjectArray *) nil_chk(((OrgApacheLuceneSearchTopDocs *) nil_chk(firstPassTopDocs))->scoreDocs_)) java_clone];
  JavaUtilArrays_sortWithNSObjectArray_withJavaUtilComparator_(hits, create_OrgApacheLuceneSearchSortRescorer_1_init());
  id<JavaUtilList> leaves = JreRetainedLocalValue([((OrgApacheLuceneIndexIndexReader *) nil_chk([((OrgApacheLuceneSearchIndexSearcher *) nil_chk(searcher)) getIndexReader])) leaves]);
  OrgApacheLuceneSearchTopFieldCollector *collector = OrgApacheLuceneSearchTopFieldCollector_createWithOrgApacheLuceneSearchSort_withInt_withBoolean_withBoolean_withBoolean_(sort_, topN, true, true, true);
  jint hitUpto = 0;
  jint readerUpto = -1;
  jint endDoc = 0;
  jint docBase = 0;
  id<OrgApacheLuceneSearchLeafCollector> leafCollector = nil;
  OrgApacheLuceneSearchFakeScorer *fakeScorer = create_OrgApacheLuceneSearchFakeScorer_initPackagePrivate();
  while (hitUpto < ((IOSObjectArray *) nil_chk(hits))->size_) {
    OrgApacheLuceneSearchScoreDoc *hit = IOSObjectArray_Get(hits, hitUpto);
    jint docID = ((OrgApacheLuceneSearchScoreDoc *) nil_chk(hit))->doc_;
    OrgApacheLuceneIndexLeafReaderContext *readerContext = nil;
    while (docID >= endDoc) {
      readerUpto++;
      readerContext = [((id<JavaUtilList>) nil_chk(leaves)) getWithInt:readerUpto];
      endDoc = ((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(readerContext))->docBase_ + [((OrgApacheLuceneIndexLeafReader *) nil_chk([readerContext reader])) maxDoc];
    }
    if (readerContext != nil) {
      leafCollector = [((OrgApacheLuceneSearchTopFieldCollector *) nil_chk(collector)) getLeafCollectorWithOrgApacheLuceneIndexLeafReaderContext:readerContext];
      [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(leafCollector)) setScorerWithOrgApacheLuceneSearchScorer:fakeScorer];
      docBase = readerContext->docBase_;
    }
    fakeScorer->score_ = hit->score_;
    fakeScorer->doc_ = docID - docBase;
    [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(leafCollector)) collectWithInt:fakeScorer->doc_];
    hitUpto++;
  }
  return [((OrgApacheLuceneSearchTopFieldCollector *) nil_chk(collector)) topDocs];
}

- (OrgApacheLuceneSearchExplanation *)explainWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                               withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)firstPassExplanation
                                                                            withInt:(jint)docID {
  OrgApacheLuceneSearchTopDocs *oneHit = create_OrgApacheLuceneSearchTopDocs_initWithInt_withOrgApacheLuceneSearchScoreDocArray_(1, [IOSObjectArray arrayWithObjects:(id[]){ create_OrgApacheLuceneSearchScoreDoc_initWithInt_withFloat_(docID, [((OrgApacheLuceneSearchExplanation *) nil_chk(firstPassExplanation)) getValue]) } count:1 type:OrgApacheLuceneSearchScoreDoc_class_()]);
  OrgApacheLuceneSearchTopDocs *hits = JreRetainedLocalValue([self rescoreWithOrgApacheLuceneSearchIndexSearcher:searcher withOrgApacheLuceneSearchTopDocs:oneHit withInt:1]);
  JreAssert(((OrgApacheLuceneSearchTopDocs *) nil_chk(hits))->totalHits_ == 1, @"org/apache/lucene/search/SortRescorer.java:100 condition failed: assert hits.totalHits == 1;");
  id<JavaUtilList> subs = create_JavaUtilArrayList_init();
  OrgApacheLuceneSearchExplanation *first = OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_([firstPassExplanation getValue], @"first pass score", [IOSObjectArray arrayWithObjects:(id[]){ firstPassExplanation } count:1 type:OrgApacheLuceneSearchExplanation_class_()]);
  [subs addWithId:first];
  OrgApacheLuceneSearchFieldDoc *fieldDoc = (OrgApacheLuceneSearchFieldDoc *) cast_chk(IOSObjectArray_Get(nil_chk(hits->scoreDocs_), 0), [OrgApacheLuceneSearchFieldDoc class]);
  IOSObjectArray *sortFields = [((OrgApacheLuceneSearchSort *) nil_chk(sort_)) getSort];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(sortFields))->size_; i++) {
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(0.0f, JreStrcat("$$$@", @"sort field ", [((OrgApacheLuceneSearchSortField *) nil_chk(IOSObjectArray_Get(sortFields, i))) description], @" value=", IOSObjectArray_Get(nil_chk(((OrgApacheLuceneSearchFieldDoc *) nil_chk(fieldDoc))->fields_), i)), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
  }
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_(0.0f, JreStrcat("$$", @"sort field values for sort=", [sort_ description]), subs);
}

- (void)dealloc {
  RELEASE_(sort_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneSearchTopDocs;", 0x1, 1, 2, 3, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneSearchExplanation;", 0x1, 4, 5, 3, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneSearchSort:);
  methods[1].selector = @selector(rescoreWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchTopDocs:withInt:);
  methods[2].selector = @selector(explainWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchExplanation:withInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "sort_", "LOrgApacheLuceneSearchSort;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneSearchSort;", "rescore", "LOrgApacheLuceneSearchIndexSearcher;LOrgApacheLuceneSearchTopDocs;I", "LJavaIoIOException;", "explain", "LOrgApacheLuceneSearchIndexSearcher;LOrgApacheLuceneSearchExplanation;I" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSortRescorer = { "SortRescorer", "org.apache.lucene.search", ptrTable, methods, fields, 7, 0x1, 3, 1, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneSearchSortRescorer;
}

@end

void OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSortRescorer *self, OrgApacheLuceneSearchSort *sort) {
  OrgApacheLuceneSearchRescorer_init(self);
  JreStrongAssign(&self->sort_, sort);
}

OrgApacheLuceneSearchSortRescorer *new_OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSort *sort) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSortRescorer, initWithOrgApacheLuceneSearchSort_, sort)
}

OrgApacheLuceneSearchSortRescorer *create_OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSort *sort) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSortRescorer, initWithOrgApacheLuceneSearchSort_, sort)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSortRescorer)

@implementation OrgApacheLuceneSearchSortRescorer_1

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneSearchSortRescorer_1_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (jint)compareWithId:(OrgApacheLuceneSearchScoreDoc *)a
               withId:(OrgApacheLuceneSearchScoreDoc *)b {
  return ((OrgApacheLuceneSearchScoreDoc *) nil_chk(a))->doc_ - ((OrgApacheLuceneSearchScoreDoc *) nil_chk(b))->doc_;
}

- (id<JavaUtilComparator>)reversed {
  return JavaUtilComparator_reversed(self);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilComparator:(id<JavaUtilComparator>)arg0 {
  return JavaUtilComparator_thenComparingWithJavaUtilComparator_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilFunctionFunction:(id<JavaUtilFunctionFunction>)arg0
                                             withJavaUtilComparator:(id<JavaUtilComparator>)arg1 {
  return JavaUtilComparator_thenComparingWithJavaUtilFunctionFunction_withJavaUtilComparator_(self, arg0, arg1);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilFunctionFunction:(id<JavaUtilFunctionFunction>)arg0 {
  return JavaUtilComparator_thenComparingWithJavaUtilFunctionFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingIntWithJavaUtilFunctionToIntFunction:(id<JavaUtilFunctionToIntFunction>)arg0 {
  return JavaUtilComparator_thenComparingIntWithJavaUtilFunctionToIntFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingLongWithJavaUtilFunctionToLongFunction:(id<JavaUtilFunctionToLongFunction>)arg0 {
  return JavaUtilComparator_thenComparingLongWithJavaUtilFunctionToLongFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingDoubleWithJavaUtilFunctionToDoubleFunction:(id<JavaUtilFunctionToDoubleFunction>)arg0 {
  return JavaUtilComparator_thenComparingDoubleWithJavaUtilFunctionToDoubleFunction_(self, arg0);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 0, 1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(compareWithId:withId:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "compare", "LOrgApacheLuceneSearchScoreDoc;LOrgApacheLuceneSearchScoreDoc;", "LOrgApacheLuceneSearchSortRescorer;", "rescoreWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchTopDocs:withInt:", "Ljava/lang/Object;Ljava/util/Comparator<Lorg/apache/lucene/search/ScoreDoc;>;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSortRescorer_1 = { "", "org.apache.lucene.search", ptrTable, methods, NULL, 7, 0x8010, 2, 0, 2, -1, 3, 4, -1 };
  return &_OrgApacheLuceneSearchSortRescorer_1;
}

@end

void OrgApacheLuceneSearchSortRescorer_1_init(OrgApacheLuceneSearchSortRescorer_1 *self) {
  NSObject_init(self);
}

OrgApacheLuceneSearchSortRescorer_1 *new_OrgApacheLuceneSearchSortRescorer_1_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSortRescorer_1, init)
}

OrgApacheLuceneSearchSortRescorer_1 *create_OrgApacheLuceneSearchSortRescorer_1_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSortRescorer_1, init)
}
