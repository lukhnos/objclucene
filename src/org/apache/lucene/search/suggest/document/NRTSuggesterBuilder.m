//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./suggest/src/java/org/apache/lucene/search/suggest/document/NRTSuggesterBuilder.java
//

#include "J2ObjC_source.h"
#include "java/lang/Comparable.h"
#include "java/lang/Long.h"
#include "java/lang/Math.h"
#include "java/util/PriorityQueue.h"
#include "org/apache/lucene/search/suggest/document/NRTSuggester.h"
#include "org/apache/lucene/search/suggest/document/NRTSuggesterBuilder.h"
#include "org/apache/lucene/store/DataOutput.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/BytesRefBuilder.h"
#include "org/apache/lucene/util/IntsRef.h"
#include "org/apache/lucene/util/IntsRefBuilder.h"
#include "org/apache/lucene/util/fst/Builder.h"
#include "org/apache/lucene/util/fst/ByteSequenceOutputs.h"
#include "org/apache/lucene/util/fst/FST.h"
#include "org/apache/lucene/util/fst/PairOutputs.h"
#include "org/apache/lucene/util/fst/PositiveIntOutputs.h"
#include "org/apache/lucene/util/fst/Util.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/search/suggest/document/NRTSuggesterBuilder must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder () {
 @public
  OrgApacheLuceneUtilFstPairOutputs *outputs_;
  OrgApacheLuceneUtilFstBuilder *builder_;
  OrgApacheLuceneUtilIntsRefBuilder *scratchInts_;
  OrgApacheLuceneUtilBytesRefBuilder *analyzed_;
  JavaUtilPriorityQueue *entries_;
  jint payloadSep_;
  jint endByte_;
  jint maxAnalyzedPathsPerOutput_;
}

/*!
 @brief Num arcs for nth dedup byte:
  if n <= 5: 1 + (2 * n)
  else: (1 + (2 * n)) * n
 <p>
  TODO: is there a better way to make the fst built to be
  more TopNSearcher friendly?
 */
+ (jint)maxNumArcsForDedupByteWithInt:(jint)currentNumDedupBytes;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, outputs_, OrgApacheLuceneUtilFstPairOutputs *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, builder_, OrgApacheLuceneUtilFstBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, scratchInts_, OrgApacheLuceneUtilIntsRefBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, analyzed_, OrgApacheLuceneUtilBytesRefBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, entries_, JavaUtilPriorityQueue *)

__attribute__((unused)) static jint OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_maxNumArcsForDedupByteWithInt_(jint currentNumDedupBytes);

@interface OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry : NSObject < JavaLangComparable > {
 @public
  OrgApacheLuceneUtilBytesRef *payload_;
  jlong weight_;
}

- (instancetype)initWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)payload
                                           withLong:(jlong)weight;

- (jint)compareToWithId:(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *)o;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry)

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry, payload_, OrgApacheLuceneUtilBytesRef *)

__attribute__((unused)) static void OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *self, OrgApacheLuceneUtilBytesRef *payload, jlong weight);

__attribute__((unused)) static OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *new_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneUtilBytesRef *payload, jlong weight) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *create_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneUtilBytesRef *payload, jlong weight);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry)

@implementation OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder

+ (jint)PAYLOAD_SEP {
  return OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_PAYLOAD_SEP;
}

+ (jint)END_BYTE {
  return OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_END_BYTE;
}

- (instancetype)initPackagePrivate {
  OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_initPackagePrivate(self);
  return self;
}

- (void)startTermWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)analyzed {
  [((OrgApacheLuceneUtilBytesRefBuilder *) nil_chk(self->analyzed_)) copyBytesWithOrgApacheLuceneUtilBytesRef:analyzed];
  [self->analyzed_ appendWithByte:(jbyte) endByte_];
}

- (void)addEntryWithInt:(jint)docID
withOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)surfaceForm
               withLong:(jlong)weight {
  OrgApacheLuceneUtilBytesRef *payloadRef = OrgApacheLuceneSearchSuggestDocumentNRTSuggester_PayLoadProcessor_makeWithOrgApacheLuceneUtilBytesRef_withInt_withInt_(surfaceForm, docID, payloadSep_);
  [((JavaUtilPriorityQueue *) nil_chk(entries_)) addWithId:create_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(payloadRef, OrgApacheLuceneSearchSuggestDocumentNRTSuggester_encodeWithLong_(weight))];
}

- (void)finishTerm {
  jint numArcs = 0;
  jint numDedupBytes = 1;
  [((OrgApacheLuceneUtilBytesRefBuilder *) nil_chk(analyzed_)) growWithInt:[analyzed_ length] + 1];
  [analyzed_ setLengthWithInt:[analyzed_ length] + 1];
  for (OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry * __strong entry_ in nil_chk(entries_)) {
    if (numArcs == OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_maxNumArcsForDedupByteWithInt_(numDedupBytes)) {
      [analyzed_ setByteAtWithInt:[analyzed_ length] - 1 withByte:(jbyte) (numArcs)];
      [analyzed_ growWithInt:[analyzed_ length] + 1];
      [analyzed_ setLengthWithInt:[analyzed_ length] + 1];
      numArcs = 0;
      numDedupBytes++;
    }
    [analyzed_ setByteAtWithInt:[analyzed_ length] - 1 withByte:(jbyte) numArcs++];
    OrgApacheLuceneUtilFstUtil_toIntsRefWithOrgApacheLuceneUtilBytesRef_withOrgApacheLuceneUtilIntsRefBuilder_([analyzed_ get], scratchInts_);
    [((OrgApacheLuceneUtilFstBuilder *) nil_chk(builder_)) addWithOrgApacheLuceneUtilIntsRef:[((OrgApacheLuceneUtilIntsRefBuilder *) nil_chk(scratchInts_)) get] withId:[((OrgApacheLuceneUtilFstPairOutputs *) nil_chk(outputs_)) newPairWithId:JavaLangLong_valueOfWithLong_(((OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *) nil_chk(entry_))->weight_) withId:entry_->payload_]];
  }
  maxAnalyzedPathsPerOutput_ = JavaLangMath_maxWithInt_withInt_(maxAnalyzedPathsPerOutput_, [entries_ size]);
  [entries_ clear];
}

- (jboolean)storeWithOrgApacheLuceneStoreDataOutput:(OrgApacheLuceneStoreDataOutput *)output {
  OrgApacheLuceneUtilFstFST *build = [((OrgApacheLuceneUtilFstBuilder *) nil_chk(builder_)) finish];
  if (build == nil) {
    return false;
  }
  [build saveWithOrgApacheLuceneStoreDataOutput:output];
  JreAssert(maxAnalyzedPathsPerOutput_ > 0, @"org/apache/lucene/search/suggest/document/NRTSuggesterBuilder.java:128 condition failed: assert maxAnalyzedPathsPerOutput > 0;");
  [((OrgApacheLuceneStoreDataOutput *) nil_chk(output)) writeVIntWithInt:maxAnalyzedPathsPerOutput_];
  [output writeVIntWithInt:OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_END_BYTE];
  [output writeVIntWithInt:OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_PAYLOAD_SEP];
  return true;
}

+ (jint)maxNumArcsForDedupByteWithInt:(jint)currentNumDedupBytes {
  return OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_maxNumArcsForDedupByteWithInt_(currentNumDedupBytes);
}

- (void)dealloc {
  RELEASE_(outputs_);
  RELEASE_(builder_);
  RELEASE_(scratchInts_);
  RELEASE_(analyzed_);
  RELEASE_(entries_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 0, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, 4, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 4, -1, -1, -1 },
    { NULL, "Z", 0x1, 5, 6, 4, -1, -1, -1 },
    { NULL, "I", 0xa, 7, 8, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initPackagePrivate);
  methods[1].selector = @selector(startTermWithOrgApacheLuceneUtilBytesRef:);
  methods[2].selector = @selector(addEntryWithInt:withOrgApacheLuceneUtilBytesRef:withLong:);
  methods[3].selector = @selector(finishTerm);
  methods[4].selector = @selector(storeWithOrgApacheLuceneStoreDataOutput:);
  methods[5].selector = @selector(maxNumArcsForDedupByteWithInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "PAYLOAD_SEP", "I", .constantValue.asInt = OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_PAYLOAD_SEP, 0x19, -1, -1, -1, -1 },
    { "END_BYTE", "I", .constantValue.asInt = OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_END_BYTE, 0x19, -1, -1, -1, -1 },
    { "outputs_", "LOrgApacheLuceneUtilFstPairOutputs;", .constantValue.asLong = 0, 0x12, -1, -1, 9, -1 },
    { "builder_", "LOrgApacheLuceneUtilFstBuilder;", .constantValue.asLong = 0, 0x12, -1, -1, 10, -1 },
    { "scratchInts_", "LOrgApacheLuceneUtilIntsRefBuilder;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "analyzed_", "LOrgApacheLuceneUtilBytesRefBuilder;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "entries_", "LJavaUtilPriorityQueue;", .constantValue.asLong = 0, 0x12, -1, -1, 11, -1 },
    { "payloadSep_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "endByte_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "maxAnalyzedPathsPerOutput_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "startTerm", "LOrgApacheLuceneUtilBytesRef;", "addEntry", "ILOrgApacheLuceneUtilBytesRef;J", "LJavaIoIOException;", "store", "LOrgApacheLuceneStoreDataOutput;", "maxNumArcsForDedupByte", "I", "Lorg/apache/lucene/util/fst/PairOutputs<Ljava/lang/Long;Lorg/apache/lucene/util/BytesRef;>;", "Lorg/apache/lucene/util/fst/Builder<Lorg/apache/lucene/util/fst/PairOutputs$Pair<Ljava/lang/Long;Lorg/apache/lucene/util/BytesRef;>;>;", "Ljava/util/PriorityQueue<Lorg/apache/lucene/search/suggest/document/NRTSuggesterBuilder$Entry;>;", "LOrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder = { "NRTSuggesterBuilder", "org.apache.lucene.search.suggest.document", ptrTable, methods, fields, 7, 0x10, 6, 10, -1, 12, -1, -1, -1 };
  return &_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder;
}

@end

void OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_initPackagePrivate(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder *self) {
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->scratchInts_, new_OrgApacheLuceneUtilIntsRefBuilder_init());
  JreStrongAssignAndConsume(&self->analyzed_, new_OrgApacheLuceneUtilBytesRefBuilder_init());
  self->maxAnalyzedPathsPerOutput_ = 0;
  self->payloadSep_ = OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_PAYLOAD_SEP;
  self->endByte_ = OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_END_BYTE;
  JreStrongAssignAndConsume(&self->outputs_, new_OrgApacheLuceneUtilFstPairOutputs_initWithOrgApacheLuceneUtilFstOutputs_withOrgApacheLuceneUtilFstOutputs_(OrgApacheLuceneUtilFstPositiveIntOutputs_getSingleton(), OrgApacheLuceneUtilFstByteSequenceOutputs_getSingleton()));
  JreStrongAssignAndConsume(&self->entries_, new_JavaUtilPriorityQueue_init());
  JreStrongAssignAndConsume(&self->builder_, new_OrgApacheLuceneUtilFstBuilder_initWithOrgApacheLuceneUtilFstFST_INPUT_TYPE_withOrgApacheLuceneUtilFstOutputs_(JreLoadEnum(OrgApacheLuceneUtilFstFST_INPUT_TYPE, BYTE1), self->outputs_));
}

OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder *new_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_initPackagePrivate() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, initPackagePrivate)
}

OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder *create_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_initPackagePrivate() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder, initPackagePrivate)
}

jint OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_maxNumArcsForDedupByteWithInt_(jint currentNumDedupBytes) {
  OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_initialize();
  jint maxArcs = 1 + (2 * currentNumDedupBytes);
  if (currentNumDedupBytes > 5) {
    maxArcs *= currentNumDedupBytes;
  }
  return JavaLangMath_minWithInt_withInt_(maxArcs, 255);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder)

@implementation OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry

- (instancetype)initWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)payload
                                           withLong:(jlong)weight {
  OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(self, payload, weight);
  return self;
}

- (jint)compareToWithId:(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *)o {
  cast_chk(o, [OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry class]);
  return JavaLangLong_compareWithLong_withLong_(weight_, ((OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *) nil_chk(o))->weight_);
}

- (void)dealloc {
  RELEASE_(payload_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 1, 2, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneUtilBytesRef:withLong:);
  methods[1].selector = @selector(compareToWithId:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "payload_", "LOrgApacheLuceneUtilBytesRef;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "weight_", "J", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneUtilBytesRef;J", "compareTo", "LOrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry;", "LOrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder;", "Ljava/lang/Object;Ljava/lang/Comparable<Lorg/apache/lucene/search/suggest/document/NRTSuggesterBuilder$Entry;>;" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry = { "Entry", "org.apache.lucene.search.suggest.document", ptrTable, methods, fields, 7, 0x1a, 2, 2, 3, -1, -1, 4, -1 };
  return &_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry;
}

@end

void OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *self, OrgApacheLuceneUtilBytesRef *payload, jlong weight) {
  NSObject_init(self);
  JreStrongAssign(&self->payload_, payload);
  self->weight_ = weight;
}

OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *new_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneUtilBytesRef *payload, jlong weight) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry, initWithOrgApacheLuceneUtilBytesRef_withLong_, payload, weight)
}

OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry *create_OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry_initWithOrgApacheLuceneUtilBytesRef_withLong_(OrgApacheLuceneUtilBytesRef *payload, jlong weight) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry, initWithOrgApacheLuceneUtilBytesRef_withLong_, payload, weight)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSuggestDocumentNRTSuggesterBuilder_Entry)
