//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./queryparser/src/java/org/apache/lucene/queryparser/xml/builders/CachedFilterBuilder.java
//

#include "J2ObjC_source.h"
#include "java/util/LinkedHashMap.h"
#include "java/util/Map.h"
#include "org/apache/lucene/queryparser/xml/DOMUtils.h"
#include "org/apache/lucene/queryparser/xml/FilterBuilderFactory.h"
#include "org/apache/lucene/queryparser/xml/QueryBuilder.h"
#include "org/apache/lucene/queryparser/xml/QueryBuilderFactory.h"
#include "org/apache/lucene/queryparser/xml/builders/CachedFilterBuilder.h"
#include "org/apache/lucene/search/CachingWrapperQuery.h"
#include "org/apache/lucene/search/Filter.h"
#include "org/apache/lucene/search/Query.h"
#include "org/apache/lucene/search/QueryWrapperFilter.h"
#include "org/w3c/dom/Element.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/queryparser/xml/builders/CachedFilterBuilder must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder () {
 @public
  OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory_;
  OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory_;
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *filterCache_;
  jint cacheSize_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, queryFactory_, OrgApacheLuceneQueryparserXmlQueryBuilderFactory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, filterFactory_, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, filterCache_, OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *)

@implementation OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder

- (instancetype)initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory:(OrgApacheLuceneQueryparserXmlQueryBuilderFactory *)queryFactory
                   withOrgApacheLuceneQueryparserXmlFilterBuilderFactory:(OrgApacheLuceneQueryparserXmlFilterBuilderFactory *)filterFactory
                                                                 withInt:(jint)cacheSize {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(self, queryFactory, filterFactory, cacheSize);
  return self;
}

- (OrgApacheLuceneSearchFilter *)getFilterWithOrgW3cDomElement:(id<OrgW3cDomElement>)e {
  @synchronized(self) {
    id<OrgW3cDomElement> childElement = OrgApacheLuceneQueryparserXmlDOMUtils_getFirstChildOrFailWithOrgW3cDomElement_(e);
    if (filterCache_ == nil) {
      JreStrongAssignAndConsume(&filterCache_, new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(cacheSize_));
    }
    id<OrgApacheLuceneQueryparserXmlQueryBuilder> qb = JreRetainedLocalValue([((OrgApacheLuceneQueryparserXmlQueryBuilderFactory *) nil_chk(queryFactory_)) getQueryBuilderWithNSString:[((id<OrgW3cDomElement>) nil_chk(childElement)) getNodeName]]);
    id cacheKey = nil;
    OrgApacheLuceneSearchQuery *q = nil;
    OrgApacheLuceneSearchFilter *f = nil;
    if (qb != nil) {
      q = [qb getQueryWithOrgW3cDomElement:childElement];
      cacheKey = q;
    }
    else {
      f = [((OrgApacheLuceneQueryparserXmlFilterBuilderFactory *) nil_chk(filterFactory_)) getFilterWithOrgW3cDomElement:childElement];
      cacheKey = f;
    }
    OrgApacheLuceneSearchQuery *cachedFilter = JreRetainedLocalValue([((OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *) nil_chk(filterCache_)) getWithId:cacheKey]);
    if (cachedFilter != nil) {
      return create_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(cachedFilter);
    }
    if (qb != nil) {
      cachedFilter = create_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(q);
    }
    else {
      cachedFilter = create_OrgApacheLuceneSearchCachingWrapperQuery_initWithOrgApacheLuceneSearchQuery_(f);
    }
    [((OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *) nil_chk(filterCache_)) putWithId:cacheKey withId:cachedFilter];
    return create_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(cachedFilter);
  }
}

- (void)dealloc {
  RELEASE_(queryFactory_);
  RELEASE_(filterFactory_);
  RELEASE_(filterCache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneSearchFilter;", 0x21, 1, 2, 3, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory:withOrgApacheLuceneQueryparserXmlFilterBuilderFactory:withInt:);
  methods[1].selector = @selector(getFilterWithOrgW3cDomElement:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "queryFactory_", "LOrgApacheLuceneQueryparserXmlQueryBuilderFactory;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "filterFactory_", "LOrgApacheLuceneQueryparserXmlFilterBuilderFactory;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "filterCache_", "LOrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache;", .constantValue.asLong = 0, 0x2, -1, -1, 4, -1 },
    { "cacheSize_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneQueryparserXmlQueryBuilderFactory;LOrgApacheLuceneQueryparserXmlFilterBuilderFactory;I", "getFilter", "LOrgW3cDomElement;", "LOrgApacheLuceneQueryparserXmlParserException;", "Lorg/apache/lucene/queryparser/xml/builders/CachedFilterBuilder$LRUCache<Ljava/lang/Object;Lorg/apache/lucene/search/Query;>;", "LOrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache;" };
  static const J2ObjcClassInfo _OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder = { "CachedFilterBuilder", "org.apache.lucene.queryparser.xml.builders", ptrTable, methods, fields, 7, 0x1, 2, 4, -1, 5, -1, -1, -1 };
  return &_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder;
}

@end

void OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *self, OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory, jint cacheSize) {
  NSObject_init(self);
  JreStrongAssign(&self->queryFactory_, queryFactory);
  JreStrongAssign(&self->filterFactory_, filterFactory);
  self->cacheSize_ = cacheSize;
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory, jint cacheSize) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_, queryFactory, filterFactory, cacheSize)
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *create_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory, jint cacheSize) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_, queryFactory, filterFactory, cacheSize)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder)

@implementation OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache

- (instancetype)initWithInt:(jint)maxsize {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(self, maxsize);
  return self;
}

- (jboolean)removeEldestEntryWithJavaUtilMap_Entry:(id<JavaUtilMap_Entry>)eldest {
  return [self size] > maxsize_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x4, 1, 2, -1, 3, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithInt:);
  methods[1].selector = @selector(removeEldestEntryWithJavaUtilMap_Entry:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "maxsize_", "I", .constantValue.asLong = 0, 0x4, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "I", "removeEldestEntry", "LJavaUtilMap_Entry;", "(Ljava/util/Map$Entry<TK;TV;>;)Z", "LOrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder;", "<K:Ljava/lang/Object;V:Ljava/lang/Object;>Ljava/util/LinkedHashMap<TK;TV;>;" };
  static const J2ObjcClassInfo _OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache = { "LRUCache", "org.apache.lucene.queryparser.xml.builders", ptrTable, methods, fields, 7, 0x8, 2, 1, 4, -1, -1, 5, -1 };
  return &_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache;
}

@end

void OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *self, jint maxsize) {
  JavaUtilLinkedHashMap_initWithInt_withFloat_withBoolean_(self, JreIntDiv(maxsize * 4, 3) + 1, 0.75f, true);
  self->maxsize_ = maxsize;
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(jint maxsize) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache, initWithInt_, maxsize)
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *create_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(jint maxsize) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache, initWithInt_, maxsize)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache)
