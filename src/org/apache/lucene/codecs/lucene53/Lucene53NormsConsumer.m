//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/codecs/lucene53/Lucene53NormsConsumer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/lang/Byte.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/Iterable.h"
#include "java/lang/Long.h"
#include "java/lang/Math.h"
#include "java/lang/Short.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/NormsConsumer.h"
#include "org/apache/lucene/codecs/lucene53/Lucene53NormsConsumer.h"
#include "org/apache/lucene/codecs/lucene53/Lucene53NormsFormat.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentWriteState.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/IOUtils.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/codecs/lucene53/Lucene53NormsConsumer must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer ()

- (void)addConstantWithLong:(jlong)constant;

- (void)addByte1WithJavaLangIterable:(id<JavaLangIterable>)values;

- (void)addByte2WithJavaLangIterable:(id<JavaLangIterable>)values;

- (void)addByte4WithJavaLangIterable:(id<JavaLangIterable>)values;

- (void)addByte8WithJavaLangIterable:(id<JavaLangIterable>)values;

@end

__attribute__((unused)) static void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addConstantWithLong_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, jlong constant);

__attribute__((unused)) static void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte1WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values);

__attribute__((unused)) static void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte2WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values);

__attribute__((unused)) static void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte4WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values);

__attribute__((unused)) static void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte8WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values);

@implementation OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer

- (instancetype)initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState:(OrgApacheLuceneIndexSegmentWriteState *)state
                                                               withNSString:(NSString *)dataCodec
                                                               withNSString:(NSString *)dataExtension
                                                               withNSString:(NSString *)metaCodec
                                                               withNSString:(NSString *)metaExtension {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(self, state, dataCodec, dataExtension, metaCodec, metaExtension);
  return self;
}

- (void)addNormsFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                  withJavaLangIterable:(id<JavaLangIterable>)values {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  jlong minValue = JavaLangLong_MAX_VALUE;
  jlong maxValue = JavaLangLong_MIN_VALUE;
  jint count = 0;
  for (NSNumber * __strong nv in nil_chk(values)) {
    if (nv == nil) {
      @throw create_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$$I", @"illegal norms data for field ", field->name_, @", got null for value: ", count));
    }
    jlong v = [nv longLongValue];
    minValue = JavaLangMath_minWithLong_withLong_(minValue, v);
    maxValue = JavaLangMath_maxWithLong_withLong_(maxValue, v);
    count++;
  }
  if (count != maxDoc_) {
    @throw create_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$$I$I", @"illegal norms data for field ", field->name_, @", expected count=", maxDoc_, @", got=", count));
  }
  if (minValue == maxValue) {
    OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addConstantWithLong_(self, minValue);
  }
  else if (minValue >= JavaLangByte_MIN_VALUE && maxValue <= JavaLangByte_MAX_VALUE) {
    OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte1WithJavaLangIterable_(self, values);
  }
  else if (minValue >= JavaLangShort_MIN_VALUE && maxValue <= JavaLangShort_MAX_VALUE) {
    OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte2WithJavaLangIterable_(self, values);
  }
  else if (minValue >= JavaLangInteger_MIN_VALUE && maxValue <= JavaLangInteger_MAX_VALUE) {
    OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte4WithJavaLangIterable_(self, values);
  }
  else {
    OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte8WithJavaLangIterable_(self, values);
  }
}

- (void)addConstantWithLong:(jlong)constant {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addConstantWithLong_(self, constant);
}

- (void)addByte1WithJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte1WithJavaLangIterable_(self, values);
}

- (void)addByte2WithJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte2WithJavaLangIterable_(self, values);
}

- (void)addByte4WithJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte4WithJavaLangIterable_(self, values);
}

- (void)addByte8WithJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte8WithJavaLangIterable_(self, values);
}

- (void)close {
  jboolean success = false;
  @try {
    if (meta_ != nil) {
      [meta_ writeVIntWithInt:-1];
      OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(meta_);
    }
    if (data_ != nil) {
      OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(data_);
    }
    success = true;
  }
  @finally {
    if (success) {
      OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ data_, meta_ } count:2 type:JavaIoCloseable_class_()]);
    }
    else {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ data_, meta_ } count:2 type:JavaIoCloseable_class_()]);
    }
    JreStrongAssign(&meta_, JreStrongAssign(&data_, nil));
  }
}

- (void)dealloc {
  RELEASE_(data_);
  RELEASE_(meta_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, 1, -1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, 1, 4, -1, -1 },
    { NULL, "V", 0x2, 5, 6, 1, -1, -1, -1 },
    { NULL, "V", 0x2, 7, 8, 1, 9, -1, -1 },
    { NULL, "V", 0x2, 10, 8, 1, 9, -1, -1 },
    { NULL, "V", 0x2, 11, 8, 1, 9, -1, -1 },
    { NULL, "V", 0x2, 12, 8, 1, 9, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState:withNSString:withNSString:withNSString:withNSString:);
  methods[1].selector = @selector(addNormsFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:);
  methods[2].selector = @selector(addConstantWithLong:);
  methods[3].selector = @selector(addByte1WithJavaLangIterable:);
  methods[4].selector = @selector(addByte2WithJavaLangIterable:);
  methods[5].selector = @selector(addByte4WithJavaLangIterable:);
  methods[6].selector = @selector(addByte8WithJavaLangIterable:);
  methods[7].selector = @selector(close);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "data_", "LOrgApacheLuceneStoreIndexOutput;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "meta_", "LOrgApacheLuceneStoreIndexOutput;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "maxDoc_", "I", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneIndexSegmentWriteState;LNSString;LNSString;LNSString;LNSString;", "LJavaIoIOException;", "addNormsField", "LOrgApacheLuceneIndexFieldInfo;LJavaLangIterable;", "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Ljava/lang/Number;>;)V", "addConstant", "J", "addByte1", "LJavaLangIterable;", "(Ljava/lang/Iterable<Ljava/lang/Number;>;)V", "addByte2", "addByte4", "addByte8" };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer = { "Lucene53NormsConsumer", "org.apache.lucene.codecs.lucene53", ptrTable, methods, fields, 7, 0x0, 8, 3, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer;
}

@end

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, OrgApacheLuceneIndexSegmentWriteState *state, NSString *dataCodec, NSString *dataExtension, NSString *metaCodec, NSString *metaExtension) {
  OrgApacheLuceneCodecsNormsConsumer_init(self);
  jboolean success = false;
  @try {
    NSString *dataName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(state))->segmentInfo_))->name_, state->segmentSuffix_, dataExtension);
    JreStrongAssign(&self->data_, [((OrgApacheLuceneStoreDirectory *) nil_chk(state->directory_)) createOutputWithNSString:dataName withOrgApacheLuceneStoreIOContext:state->context_]);
    OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(self->data_, dataCodec, OrgApacheLuceneCodecsLucene53Lucene53NormsFormat_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
    NSString *metaName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(state->segmentInfo_->name_, state->segmentSuffix_, metaExtension);
    JreStrongAssign(&self->meta_, [state->directory_ createOutputWithNSString:metaName withOrgApacheLuceneStoreIOContext:state->context_]);
    OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(self->meta_, metaCodec, OrgApacheLuceneCodecsLucene53Lucene53NormsFormat_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
    self->maxDoc_ = [state->segmentInfo_ maxDoc];
    success = true;
  }
  @finally {
    if (!success) {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ self } count:1 type:JavaIoCloseable_class_()]);
    }
  }
}

OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *new_OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(OrgApacheLuceneIndexSegmentWriteState *state, NSString *dataCodec, NSString *dataExtension, NSString *metaCodec, NSString *metaExtension) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer, initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_, state, dataCodec, dataExtension, metaCodec, metaExtension)
}

OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *create_OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(OrgApacheLuceneIndexSegmentWriteState *state, NSString *dataCodec, NSString *dataExtension, NSString *metaCodec, NSString *metaExtension) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer, initPackagePrivateWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_, state, dataCodec, dataExtension, metaCodec, metaExtension)
}

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addConstantWithLong_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, jlong constant) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeByteWithByte:(jbyte) 0];
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:constant];
}

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte1WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeByteWithByte:(jbyte) 1];
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:[((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer]];
  for (NSNumber * __strong value in nil_chk(values)) {
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) writeByteWithByte:[((NSNumber *) nil_chk(value)) charValue]];
  }
}

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte2WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeByteWithByte:(jbyte) 2];
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:[((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer]];
  for (NSNumber * __strong value in nil_chk(values)) {
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) writeShortWithShort:[((NSNumber *) nil_chk(value)) shortValue]];
  }
}

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte4WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeByteWithByte:(jbyte) 4];
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:[((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer]];
  for (NSNumber * __strong value in nil_chk(values)) {
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) writeIntWithInt:[((NSNumber *) nil_chk(value)) intValue]];
  }
}

void OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer_addByte8WithJavaLangIterable_(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer *self, id<JavaLangIterable> values) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeByteWithByte:(jbyte) 8];
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:[((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer]];
  for (NSNumber * __strong value in nil_chk(values)) {
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) writeLongWithLong:[((NSNumber *) nil_chk(value)) longLongValue]];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsLucene53Lucene53NormsConsumer)
