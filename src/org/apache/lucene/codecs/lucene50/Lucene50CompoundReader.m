//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/codecs/lucene50/Lucene50CompoundReader.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/io/FileNotFoundException.h"
#include "java/lang/Throwable.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/Collection.h"
#include "java/util/Collections.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/lucene50/Lucene50CompoundFormat.h"
#include "org/apache/lucene/codecs/lucene50/Lucene50CompoundReader.h"
#include "org/apache/lucene/index/CorruptIndexException.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/store/ChecksumIndexInput.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexInput.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/store/Lock.h"
#include "org/apache/lucene/util/IOUtils.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/codecs/lucene50/Lucene50CompoundReader must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneCodecsLucene50Lucene50CompoundReader () {
 @public
  OrgApacheLuceneStoreDirectory *directory_;
  NSString *segmentName_;
  id<JavaUtilMap> entries_;
  OrgApacheLuceneStoreIndexInput *handle_;
  jint version__;
}

/*!
 @brief Helper method that reads CFS entries from an input stream
 */
- (id<JavaUtilMap>)readEntriesWithByteArray:(IOSByteArray *)segmentID
          withOrgApacheLuceneStoreDirectory:(OrgApacheLuceneStoreDirectory *)dir
                               withNSString:(NSString *)entriesFileName;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, directory_, OrgApacheLuceneStoreDirectory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, segmentName_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, entries_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, handle_, OrgApacheLuceneStoreIndexInput *)

__attribute__((unused)) static id<JavaUtilMap> OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_readEntriesWithByteArray_withOrgApacheLuceneStoreDirectory_withNSString_(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader *self, IOSByteArray *segmentID, OrgApacheLuceneStoreDirectory *dir, NSString *entriesFileName);

@implementation OrgApacheLuceneCodecsLucene50Lucene50CompoundReader

- (instancetype)initPackagePrivateWithOrgApacheLuceneStoreDirectory:(OrgApacheLuceneStoreDirectory *)directory
                                withOrgApacheLuceneIndexSegmentInfo:(OrgApacheLuceneIndexSegmentInfo *)si
                                  withOrgApacheLuceneStoreIOContext:(OrgApacheLuceneStoreIOContext *)context {
  OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_(self, directory, si, context);
  return self;
}

- (id<JavaUtilMap>)readEntriesWithByteArray:(IOSByteArray *)segmentID
          withOrgApacheLuceneStoreDirectory:(OrgApacheLuceneStoreDirectory *)dir
                               withNSString:(NSString *)entriesFileName {
  return OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_readEntriesWithByteArray_withOrgApacheLuceneStoreDirectory_withNSString_(self, segmentID, dir, entriesFileName);
}

- (void)close {
  OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ handle_ } count:1 type:JavaIoCloseable_class_()]);
}

- (OrgApacheLuceneStoreIndexInput *)openInputWithNSString:(NSString *)name
                        withOrgApacheLuceneStoreIOContext:(OrgApacheLuceneStoreIOContext *)context {
  [self ensureOpen];
  NSString *id_ = OrgApacheLuceneIndexIndexFileNames_stripSegmentNameWithNSString_(name);
  OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *entry_ = [((id<JavaUtilMap>) nil_chk(entries_)) getWithId:id_];
  if (entry_ == nil) {
    @throw create_JavaIoFileNotFoundException_initWithNSString_(JreStrcat("$$$$$@C", @"No sub-file with id ", id_, @" found (fileName=", name, @" files: ", [entries_ keySet], ')'));
  }
  return [((OrgApacheLuceneStoreIndexInput *) nil_chk(handle_)) sliceWithNSString:name withLong:entry_->offset_ withLong:entry_->length_];
}

- (IOSObjectArray *)listAll {
  [self ensureOpen];
  IOSObjectArray *res = [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(entries_)) keySet])) toArrayWithNSObjectArray:[IOSObjectArray arrayWithLength:[entries_ size] type:NSString_class_()]];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(res))->size_; i++) {
    IOSObjectArray_Set(res, i, JreStrcat("$$", segmentName_, IOSObjectArray_Get(res, i)));
  }
  return res;
}

- (void)deleteFileWithNSString:(NSString *)name {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)renameFileWithNSString:(NSString *)from
                  withNSString:(NSString *)to {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (jlong)fileLengthWithNSString:(NSString *)name {
  [self ensureOpen];
  OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *e = JreRetainedLocalValue([((id<JavaUtilMap>) nil_chk(entries_)) getWithId:OrgApacheLuceneIndexIndexFileNames_stripSegmentNameWithNSString_(name)]);
  if (e == nil) @throw create_JavaIoFileNotFoundException_initWithNSString_(name);
  return e->length_;
}

- (OrgApacheLuceneStoreIndexOutput *)createOutputWithNSString:(NSString *)name
                            withOrgApacheLuceneStoreIOContext:(OrgApacheLuceneStoreIOContext *)context {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)syncWithJavaUtilCollection:(id<JavaUtilCollection>)names {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (OrgApacheLuceneStoreLock *)obtainLockWithNSString:(NSString *)name {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (NSString *)description {
  return JreStrcat("$$$@C", @"CompoundFileDirectory(segment=\"", segmentName_, @"\" in dir=", directory_, ')');
}

- (void)dealloc {
  RELEASE_(directory_);
  RELEASE_(segmentName_);
  RELEASE_(entries_);
  RELEASE_(handle_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, 1, -1, -1, -1 },
    { NULL, "LJavaUtilMap;", 0x12, 2, 3, 1, 4, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneStoreIndexInput;", 0x1, 5, 6, 1, -1, -1, -1 },
    { NULL, "[LNSString;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 7, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 9, 10, -1, -1, -1, -1 },
    { NULL, "J", 0x1, 11, 8, 1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneStoreIndexOutput;", 0x1, 12, 6, 1, -1, -1, -1 },
    { NULL, "V", 0x1, 13, 14, -1, 15, -1, -1 },
    { NULL, "LOrgApacheLuceneStoreLock;", 0x1, 16, 8, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 17, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initPackagePrivateWithOrgApacheLuceneStoreDirectory:withOrgApacheLuceneIndexSegmentInfo:withOrgApacheLuceneStoreIOContext:);
  methods[1].selector = @selector(readEntriesWithByteArray:withOrgApacheLuceneStoreDirectory:withNSString:);
  methods[2].selector = @selector(close);
  methods[3].selector = @selector(openInputWithNSString:withOrgApacheLuceneStoreIOContext:);
  methods[4].selector = @selector(listAll);
  methods[5].selector = @selector(deleteFileWithNSString:);
  methods[6].selector = @selector(renameFileWithNSString:withNSString:);
  methods[7].selector = @selector(fileLengthWithNSString:);
  methods[8].selector = @selector(createOutputWithNSString:withOrgApacheLuceneStoreIOContext:);
  methods[9].selector = @selector(syncWithJavaUtilCollection:);
  methods[10].selector = @selector(obtainLockWithNSString:);
  methods[11].selector = @selector(description);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "directory_", "LOrgApacheLuceneStoreDirectory;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "segmentName_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "entries_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x12, -1, -1, 18, -1 },
    { "handle_", "LOrgApacheLuceneStoreIndexInput;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "version__", "I", .constantValue.asLong = 0, 0x2, 19, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneStoreDirectory;LOrgApacheLuceneIndexSegmentInfo;LOrgApacheLuceneStoreIOContext;", "LJavaIoIOException;", "readEntries", "[BLOrgApacheLuceneStoreDirectory;LNSString;", "([BLorg/apache/lucene/store/Directory;Ljava/lang/String;)Ljava/util/Map<Ljava/lang/String;Lorg/apache/lucene/codecs/lucene50/Lucene50CompoundReader$FileEntry;>;", "openInput", "LNSString;LOrgApacheLuceneStoreIOContext;", "deleteFile", "LNSString;", "renameFile", "LNSString;LNSString;", "fileLength", "createOutput", "sync", "LJavaUtilCollection;", "(Ljava/util/Collection<Ljava/lang/String;>;)V", "obtainLock", "toString", "Ljava/util/Map<Ljava/lang/String;Lorg/apache/lucene/codecs/lucene50/Lucene50CompoundReader$FileEntry;>;", "version", "LOrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry;" };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsLucene50Lucene50CompoundReader = { "Lucene50CompoundReader", "org.apache.lucene.codecs.lucene50", ptrTable, methods, fields, 7, 0x10, 12, 5, -1, 20, -1, -1, -1 };
  return &_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader;
}

@end

void OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader *self, OrgApacheLuceneStoreDirectory *directory, OrgApacheLuceneIndexSegmentInfo *si, OrgApacheLuceneStoreIOContext *context) {
  OrgApacheLuceneStoreDirectory_init(self);
  JreStrongAssign(&self->directory_, directory);
  JreStrongAssign(&self->segmentName_, ((OrgApacheLuceneIndexSegmentInfo *) nil_chk(si))->name_);
  NSString *dataFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(self->segmentName_, @"", OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_DATA_EXTENSION);
  NSString *entriesFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(self->segmentName_, @"", OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_ENTRIES_EXTENSION);
  JreStrongAssign(&self->entries_, OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_readEntriesWithByteArray_withOrgApacheLuceneStoreDirectory_withNSString_(self, [si getId], directory, entriesFileName));
  jboolean success = false;
  JreStrongAssign(&self->handle_, [((OrgApacheLuceneStoreDirectory *) nil_chk(directory)) openInputWithNSString:dataFileName withOrgApacheLuceneStoreIOContext:context]);
  @try {
    OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(self->handle_, OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_DATA_CODEC, self->version__, self->version__, [si getId], @"");
    OrgApacheLuceneCodecsCodecUtil_retrieveChecksumWithOrgApacheLuceneStoreIndexInput_(self->handle_);
    success = true;
  }
  @finally {
    if (!success) {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ self->handle_ } count:1 type:JavaIoCloseable_class_()]);
    }
  }
}

OrgApacheLuceneCodecsLucene50Lucene50CompoundReader *new_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_(OrgApacheLuceneStoreDirectory *directory, OrgApacheLuceneIndexSegmentInfo *si, OrgApacheLuceneStoreIOContext *context) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_, directory, si, context)
}

OrgApacheLuceneCodecsLucene50Lucene50CompoundReader *create_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_(OrgApacheLuceneStoreDirectory *directory, OrgApacheLuceneIndexSegmentInfo *si, OrgApacheLuceneStoreIOContext *context) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader, initPackagePrivateWithOrgApacheLuceneStoreDirectory_withOrgApacheLuceneIndexSegmentInfo_withOrgApacheLuceneStoreIOContext_, directory, si, context)
}

id<JavaUtilMap> OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_readEntriesWithByteArray_withOrgApacheLuceneStoreDirectory_withNSString_(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader *self, IOSByteArray *segmentID, OrgApacheLuceneStoreDirectory *dir, NSString *entriesFileName) {
  id<JavaUtilMap> mapping = nil;
  {
    OrgApacheLuceneStoreChecksumIndexInput *entriesStream = [((OrgApacheLuceneStoreDirectory *) nil_chk(dir)) openChecksumInputWithNSString:entriesFileName withOrgApacheLuceneStoreIOContext:JreLoadStatic(OrgApacheLuceneStoreIOContext, READONCE)];
    JavaLangThrowable *__primaryException1 = nil;
    @try {
      JavaLangThrowable *priorE = nil;
      @try {
        self->version__ = OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(entriesStream, OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_ENTRY_CODEC, OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_VERSION_START, OrgApacheLuceneCodecsLucene50Lucene50CompoundFormat_VERSION_CURRENT, segmentID, @"");
        jint numEntries = [((OrgApacheLuceneStoreChecksumIndexInput *) nil_chk(entriesStream)) readVInt];
        mapping = create_JavaUtilHashMap_initWithInt_(numEntries);
        for (jint i = 0; i < numEntries; i++) {
          OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *fileEntry = create_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry_init();
          NSString *id_ = [entriesStream readString];
          OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *previous = JreRetainedLocalValue([mapping putWithId:id_ withId:fileEntry]);
          if (previous != nil) {
            @throw create_OrgApacheLuceneIndexCorruptIndexException_initWithNSString_withOrgApacheLuceneStoreDataInput_(JreStrcat("$$$", @"Duplicate cfs entry id=", id_, @" in CFS "), entriesStream);
          }
          fileEntry->offset_ = [entriesStream readLong];
          fileEntry->length_ = [entriesStream readLong];
        }
      }
      @catch (JavaLangThrowable *exception) {
        priorE = exception;
      }
      @finally {
        OrgApacheLuceneCodecsCodecUtil_checkFooterWithOrgApacheLuceneStoreChecksumIndexInput_withJavaLangThrowable_(entriesStream, priorE);
      }
    }
    @catch (JavaLangThrowable *e) {
      __primaryException1 = e;
      @throw e;
    }
    @finally {
      if (entriesStream != nil) {
        if (__primaryException1 != nil) {
          @try {
            [entriesStream close];
          }
          @catch (JavaLangThrowable *e) {
            [__primaryException1 addSuppressedWithJavaLangThrowable:e];
          }
        }
        else {
          [entriesStream close];
        }
      }
    }
  }
  return JavaUtilCollections_unmodifiableMapWithJavaUtilMap_(mapping);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader)

@implementation OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "offset_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "length_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneCodecsLucene50Lucene50CompoundReader;" };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry = { "FileEntry", "org.apache.lucene.codecs.lucene50", ptrTable, methods, fields, 7, 0x19, 1, 2, 0, -1, -1, -1, -1 };
  return &_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry;
}

@end

void OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry_init(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *self) {
  NSObject_init(self);
}

OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *new_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry, init)
}

OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry *create_OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsLucene50Lucene50CompoundReader_FileEntry)
