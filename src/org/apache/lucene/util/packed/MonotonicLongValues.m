//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/util/packed/MonotonicLongValues.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/util/Arrays.h"
#include "org/apache/lucene/util/RamUsageEstimator.h"
#include "org/apache/lucene/util/packed/DeltaPackedLongValues.h"
#include "org/apache/lucene/util/packed/MonotonicBlockPackedReader.h"
#include "org/apache/lucene/util/packed/MonotonicLongValues.h"
#include "org/apache/lucene/util/packed/PackedInts.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/util/packed/MonotonicLongValues must not be compiled with ARC (-fobjc-arc)"
#endif

inline jlong OrgApacheLuceneUtilPackedMonotonicLongValues_get_BASE_RAM_BYTES_USED(void);
static jlong OrgApacheLuceneUtilPackedMonotonicLongValues_BASE_RAM_BYTES_USED;
J2OBJC_STATIC_FIELD_PRIMITIVE_FINAL(OrgApacheLuceneUtilPackedMonotonicLongValues, BASE_RAM_BYTES_USED, jlong)

inline jlong OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_get_BASE_RAM_BYTES_USED(void);
static jlong OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_BASE_RAM_BYTES_USED;
J2OBJC_STATIC_FIELD_PRIMITIVE_FINAL(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder, BASE_RAM_BYTES_USED, jlong)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneUtilPackedMonotonicLongValues)

@implementation OrgApacheLuceneUtilPackedMonotonicLongValues

- (instancetype)initPackagePrivateWithInt:(jint)pageShift
                                  withInt:(jint)pageMask
withOrgApacheLuceneUtilPackedPackedInts_ReaderArray:(IOSObjectArray *)values
                            withLongArray:(IOSLongArray *)mins
                           withFloatArray:(IOSFloatArray *)averages
                                 withLong:(jlong)size
                                 withLong:(jlong)ramBytesUsed {
  OrgApacheLuceneUtilPackedMonotonicLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_(self, pageShift, pageMask, values, mins, averages, size, ramBytesUsed);
  return self;
}

- (jlong)getWithInt:(jint)block
            withInt:(jint)element {
  return OrgApacheLuceneUtilPackedMonotonicBlockPackedReader_expectedWithLong_withFloat_withInt_(IOSLongArray_Get(nil_chk(mins_), block), IOSFloatArray_Get(nil_chk(averages_), block), element) + [((OrgApacheLuceneUtilPackedPackedInts_Reader *) nil_chk(IOSObjectArray_Get(nil_chk(values_), block))) getWithInt:element];
}

- (jint)decodeBlockWithInt:(jint)block
             withLongArray:(IOSLongArray *)dest {
  jint count = [super decodeBlockWithInt:block withLongArray:dest];
  jfloat average = IOSFloatArray_Get(nil_chk(averages_), block);
  for (jint i = 0; i < count; ++i) {
    *IOSLongArray_GetRef(nil_chk(dest), i) += OrgApacheLuceneUtilPackedMonotonicBlockPackedReader_expectedWithLong_withFloat_withInt_(0, average, i);
  }
  return count;
}

- (void)dealloc {
  RELEASE_(averages_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, -1, -1, -1, -1 },
    { NULL, "J", 0x0, 1, 2, -1, -1, -1, -1 },
    { NULL, "I", 0x0, 3, 4, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initPackagePrivateWithInt:withInt:withOrgApacheLuceneUtilPackedPackedInts_ReaderArray:withLongArray:withFloatArray:withLong:withLong:);
  methods[1].selector = @selector(getWithInt:withInt:);
  methods[2].selector = @selector(decodeBlockWithInt:withLongArray:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "BASE_RAM_BYTES_USED", "J", .constantValue.asLong = 0, 0x1a, -1, 5, -1, -1 },
    { "averages_", "[F", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "II[LOrgApacheLuceneUtilPackedPackedInts_Reader;[J[FJJ", "get", "II", "decodeBlock", "I[J", &OrgApacheLuceneUtilPackedMonotonicLongValues_BASE_RAM_BYTES_USED, "LOrgApacheLuceneUtilPackedMonotonicLongValues_Builder;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilPackedMonotonicLongValues = { "MonotonicLongValues", "org.apache.lucene.util.packed", ptrTable, methods, fields, 7, 0x0, 3, 2, -1, 6, -1, -1, -1 };
  return &_OrgApacheLuceneUtilPackedMonotonicLongValues;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneUtilPackedMonotonicLongValues class]) {
    OrgApacheLuceneUtilPackedMonotonicLongValues_BASE_RAM_BYTES_USED = OrgApacheLuceneUtilRamUsageEstimator_shallowSizeOfInstanceWithIOSClass_(OrgApacheLuceneUtilPackedMonotonicLongValues_class_());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneUtilPackedMonotonicLongValues)
  }
}

@end

void OrgApacheLuceneUtilPackedMonotonicLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_(OrgApacheLuceneUtilPackedMonotonicLongValues *self, jint pageShift, jint pageMask, IOSObjectArray *values, IOSLongArray *mins, IOSFloatArray *averages, jlong size, jlong ramBytesUsed) {
  OrgApacheLuceneUtilPackedDeltaPackedLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withLong_withLong_(self, pageShift, pageMask, values, mins, size, ramBytesUsed);
  JreAssert(((IOSObjectArray *) nil_chk(values))->size_ == ((IOSFloatArray *) nil_chk(averages))->size_, @"org/apache/lucene/util/packed/MonotonicLongValues.java:36 condition failed: assert values.length == averages.length;");
  JreStrongAssign(&self->averages_, averages);
}

OrgApacheLuceneUtilPackedMonotonicLongValues *new_OrgApacheLuceneUtilPackedMonotonicLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_(jint pageShift, jint pageMask, IOSObjectArray *values, IOSLongArray *mins, IOSFloatArray *averages, jlong size, jlong ramBytesUsed) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilPackedMonotonicLongValues, initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_, pageShift, pageMask, values, mins, averages, size, ramBytesUsed)
}

OrgApacheLuceneUtilPackedMonotonicLongValues *create_OrgApacheLuceneUtilPackedMonotonicLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_(jint pageShift, jint pageMask, IOSObjectArray *values, IOSLongArray *mins, IOSFloatArray *averages, jlong size, jlong ramBytesUsed) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilPackedMonotonicLongValues, initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_, pageShift, pageMask, values, mins, averages, size, ramBytesUsed)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilPackedMonotonicLongValues)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder)

@implementation OrgApacheLuceneUtilPackedMonotonicLongValues_Builder

- (instancetype)initWithInt:(jint)pageSize
                  withFloat:(jfloat)acceptableOverheadRatio {
  OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_initWithInt_withFloat_(self, pageSize, acceptableOverheadRatio);
  return self;
}

- (jlong)baseRamBytesUsed {
  return OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_BASE_RAM_BYTES_USED;
}

- (OrgApacheLuceneUtilPackedMonotonicLongValues *)build {
  [self finish];
  JreStrongAssign(&pending_, nil);
  IOSObjectArray *values = JavaUtilArrays_copyOfWithNSObjectArray_withInt_(self->values_, valuesOff_);
  IOSLongArray *mins = JavaUtilArrays_copyOfWithLongArray_withInt_(self->mins_, valuesOff_);
  IOSFloatArray *averages = JavaUtilArrays_copyOfWithFloatArray_withInt_(self->averages_, valuesOff_);
  jlong ramBytesUsed = JreLoadStatic(OrgApacheLuceneUtilPackedMonotonicLongValues, BASE_RAM_BYTES_USED) + OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithOrgApacheLuceneUtilAccountableArray_(values) + OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithLongArray_(mins) + OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithFloatArray_(averages);
  return create_OrgApacheLuceneUtilPackedMonotonicLongValues_initPackagePrivateWithInt_withInt_withOrgApacheLuceneUtilPackedPackedInts_ReaderArray_withLongArray_withFloatArray_withLong_withLong_(pageShift_, pageMask_, values, mins, averages, size_, ramBytesUsed);
}

- (void)packWithLongArray:(IOSLongArray *)values
                  withInt:(jint)numValues
                  withInt:(jint)block
                withFloat:(jfloat)acceptableOverheadRatio {
  jfloat average = numValues == 1 ? 0 : (jfloat) (IOSLongArray_Get(nil_chk(values), numValues - 1) - IOSLongArray_Get(values, 0)) / (numValues - 1);
  for (jint i = 0; i < numValues; ++i) {
    *IOSLongArray_GetRef(nil_chk(values), i) -= OrgApacheLuceneUtilPackedMonotonicBlockPackedReader_expectedWithLong_withFloat_withInt_(0, average, i);
  }
  [super packWithLongArray:values withInt:numValues withInt:block withFloat:acceptableOverheadRatio];
  *IOSFloatArray_GetRef(nil_chk(averages_), block) = average;
}

- (void)growWithInt:(jint)newBlockCount {
  [super growWithInt:newBlockCount];
  ramBytesUsed_ -= OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithFloatArray_(averages_);
  JreStrongAssign(&averages_, JavaUtilArrays_copyOfWithFloatArray_withInt_(averages_, newBlockCount));
  ramBytesUsed_ += OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithFloatArray_(averages_);
}

- (void)dealloc {
  RELEASE_(averages_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, -1, -1, -1, -1 },
    { NULL, "J", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneUtilPackedMonotonicLongValues;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x0, 1, 2, -1, -1, -1, -1 },
    { NULL, "V", 0x0, 3, 4, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithInt:withFloat:);
  methods[1].selector = @selector(baseRamBytesUsed);
  methods[2].selector = @selector(build);
  methods[3].selector = @selector(packWithLongArray:withInt:withInt:withFloat:);
  methods[4].selector = @selector(growWithInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "BASE_RAM_BYTES_USED", "J", .constantValue.asLong = 0, 0x1a, -1, 5, -1, -1 },
    { "averages_", "[F", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "IF", "pack", "[JIIF", "grow", "I", &OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_BASE_RAM_BYTES_USED, "LOrgApacheLuceneUtilPackedMonotonicLongValues;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilPackedMonotonicLongValues_Builder = { "Builder", "org.apache.lucene.util.packed", ptrTable, methods, fields, 7, 0x8, 5, 2, 6, -1, -1, -1, -1 };
  return &_OrgApacheLuceneUtilPackedMonotonicLongValues_Builder;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneUtilPackedMonotonicLongValues_Builder class]) {
    OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_BASE_RAM_BYTES_USED = OrgApacheLuceneUtilRamUsageEstimator_shallowSizeOfInstanceWithIOSClass_(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_class_());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder)
  }
}

@end

void OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_initWithInt_withFloat_(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder *self, jint pageSize, jfloat acceptableOverheadRatio) {
  OrgApacheLuceneUtilPackedDeltaPackedLongValues_Builder_initWithInt_withFloat_(self, pageSize, acceptableOverheadRatio);
  JreStrongAssignAndConsume(&self->averages_, [IOSFloatArray newArrayWithLength:((IOSObjectArray *) nil_chk(self->values_))->size_]);
  self->ramBytesUsed_ += OrgApacheLuceneUtilRamUsageEstimator_sizeOfWithFloatArray_(self->averages_);
}

OrgApacheLuceneUtilPackedMonotonicLongValues_Builder *new_OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_initWithInt_withFloat_(jint pageSize, jfloat acceptableOverheadRatio) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder, initWithInt_withFloat_, pageSize, acceptableOverheadRatio)
}

OrgApacheLuceneUtilPackedMonotonicLongValues_Builder *create_OrgApacheLuceneUtilPackedMonotonicLongValues_Builder_initWithInt_withFloat_(jint pageSize, jfloat acceptableOverheadRatio) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder, initWithInt_withFloat_, pageSize, acceptableOverheadRatio)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilPackedMonotonicLongValues_Builder)
