//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/util/automaton/FiniteStringsIterator.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/System.h"
#include "java/util/BitSet.h"
#include "org/apache/lucene/util/ArrayUtil.h"
#include "org/apache/lucene/util/IntsRef.h"
#include "org/apache/lucene/util/IntsRefBuilder.h"
#include "org/apache/lucene/util/RamUsageEstimator.h"
#include "org/apache/lucene/util/automaton/Automaton.h"
#include "org/apache/lucene/util/automaton/FiniteStringsIterator.h"
#include "org/apache/lucene/util/automaton/Transition.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/util/automaton/FiniteStringsIterator must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneUtilAutomatonFiniteStringsIterator () {
 @public
  /*!
   @brief Automaton to create finite string from.
   */
  OrgApacheLuceneUtilAutomatonAutomaton *a_;
  /*!
   @brief Tracks which states are in the current path, for cycle detection.
   */
  JavaUtilBitSet *pathStates_;
  /*!
   @brief Builder for current finite string.
   */
  OrgApacheLuceneUtilIntsRefBuilder *string_;
  /*!
   @brief Stack to hold our current state in the recursion/iteration.
   */
  IOSObjectArray *nodes_;
  /*!
   @brief Emit empty string?.
   */
  jboolean emitEmptyString_;
}

/*!
 @brief Grow path stack, if required.
 */
- (void)growStackWithInt:(jint)depth;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, a_, OrgApacheLuceneUtilAutomatonAutomaton *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, pathStates_, JavaUtilBitSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, string_, OrgApacheLuceneUtilIntsRefBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, nodes_, IOSObjectArray *)

/*!
 @brief Empty string.
 */
inline OrgApacheLuceneUtilIntsRef *OrgApacheLuceneUtilAutomatonFiniteStringsIterator_get_EMPTY(void);
static OrgApacheLuceneUtilIntsRef *OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, EMPTY, OrgApacheLuceneUtilIntsRef *)

__attribute__((unused)) static void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, jint depth);

/*!
 @brief Nodes for path stack.
 */
@interface OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode : NSObject {
 @public
  /*!
   @brief Which state the path node ends on, whose
   transitions we are enumerating.
   */
  jint state_;
  /*!
   @brief Which state the current transition leads to.
   */
  jint to_;
  /*!
   @brief Which transition we are on.
   */
  jint transition_;
  /*!
   @brief Which label we are on, in the min-max range of the
   current Transition
   */
  jint label_;
  OrgApacheLuceneUtilAutomatonTransition *t_;
}

- (instancetype)init;

- (void)resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a
                                                    withInt:(jint)state;

/*!
 @brief Returns next label of current transition, or
   advances to next transition and returns its first
   label, if current one is exhausted.If there are
   no more transitions, returns -1.
 */
- (jint)nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, t_, OrgApacheLuceneUtilAutomatonTransition *)

__attribute__((unused)) static void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *self);

__attribute__((unused)) static OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(void) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(void);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)

@implementation OrgApacheLuceneUtilAutomatonFiniteStringsIterator

- (instancetype)initWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(self, a);
  return self;
}

- (OrgApacheLuceneUtilIntsRef *)next {
  if (emitEmptyString_) {
    emitEmptyString_ = false;
    return OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY;
  }
  for (jint depth = [((OrgApacheLuceneUtilIntsRefBuilder *) nil_chk(string_)) length]; depth > 0; ) {
    OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *node = IOSObjectArray_Get(nil_chk(nodes_), depth - 1);
    jint label = [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(node)) nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:a_];
    if (label != -1) {
      [string_ setIntAtWithInt:depth - 1 withInt:label];
      jint to = node->to_;
      if ([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a_)) getNumTransitionsWithInt:to] != 0) {
        if ([((JavaUtilBitSet *) nil_chk(pathStates_)) getWithInt:to]) {
          @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"automaton has cycles");
        }
        [pathStates_ setWithInt:to];
        OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(self, depth);
        [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(IOSObjectArray_Get(nil_chk(nodes_), depth))) resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:a_ withInt:to];
        depth++;
        [string_ setLengthWithInt:depth];
        [string_ growWithInt:depth];
      }
      else if ([a_ isAcceptWithInt:to]) {
        return [string_ get];
      }
    }
    else {
      jint state = node->state_;
      JreAssert([((JavaUtilBitSet *) nil_chk(pathStates_)) getWithInt:state], @"org/apache/lucene/util/automaton/FiniteStringsIterator.java:138 condition failed: assert pathStates.get(state);");
      [pathStates_ clearWithInt:state];
      depth--;
      [string_ setLengthWithInt:depth];
      if ([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a_)) isAcceptWithInt:state]) {
        return [string_ get];
      }
    }
  }
  return nil;
}

- (void)growStackWithInt:(jint)depth {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(self, depth);
}

- (void)dealloc {
  RELEASE_(a_);
  RELEASE_(pathStates_);
  RELEASE_(string_);
  RELEASE_(nodes_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneUtilIntsRef;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 1, 2, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneUtilAutomatonAutomaton:);
  methods[1].selector = @selector(next);
  methods[2].selector = @selector(growStackWithInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "EMPTY", "LOrgApacheLuceneUtilIntsRef;", .constantValue.asLong = 0, 0x1a, -1, 3, -1, -1 },
    { "a_", "LOrgApacheLuceneUtilAutomatonAutomaton;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "pathStates_", "LJavaUtilBitSet;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "string_", "LOrgApacheLuceneUtilIntsRefBuilder;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "nodes_", "[LOrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "emitEmptyString_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneUtilAutomatonAutomaton;", "growStack", "I", &OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY, "LOrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilAutomatonFiniteStringsIterator = { "FiniteStringsIterator", "org.apache.lucene.util.automaton", ptrTable, methods, fields, 7, 0x1, 3, 6, -1, 4, -1, -1, -1 };
  return &_OrgApacheLuceneUtilAutomatonFiniteStringsIterator;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneUtilAutomatonFiniteStringsIterator class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY, new_OrgApacheLuceneUtilIntsRef_init());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)
  }
}

@end

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, OrgApacheLuceneUtilAutomatonAutomaton *a) {
  NSObject_init(self);
  JreStrongAssign(&self->a_, a);
  JreStrongAssignAndConsume(&self->nodes_, [IOSObjectArray newArrayWithLength:16 type:OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_class_()]);
  for (jint i = 0, end = self->nodes_->size_; i < end; i++) {
    IOSObjectArray_SetAndConsume(nil_chk(self->nodes_), i, new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init());
  }
  JreStrongAssignAndConsume(&self->string_, new_OrgApacheLuceneUtilIntsRefBuilder_init());
  JreStrongAssignAndConsume(&self->pathStates_, new_JavaUtilBitSet_initWithInt_([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumStates]));
  [self->string_ setLengthWithInt:0];
  self->emitEmptyString_ = [a isAcceptWithInt:0];
  if ([a getNumTransitionsWithInt:0] > 0) {
    [self->pathStates_ setWithInt:0];
    [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(IOSObjectArray_Get(nil_chk(self->nodes_), 0))) resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:a withInt:0];
    [self->string_ appendWithInt:0];
  }
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonAutomaton *a) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, initWithOrgApacheLuceneUtilAutomatonAutomaton_, a)
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonAutomaton *a) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, initWithOrgApacheLuceneUtilAutomatonAutomaton_, a)
}

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, jint depth) {
  if (((IOSObjectArray *) nil_chk(self->nodes_))->size_ == depth) {
    IOSObjectArray *newNodes = [IOSObjectArray arrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(self->nodes_->size_ + 1, JreLoadStatic(OrgApacheLuceneUtilRamUsageEstimator, NUM_BYTES_OBJECT_REF)) type:OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_class_()];
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(self->nodes_, 0, newNodes, 0, ((IOSObjectArray *) nil_chk(self->nodes_))->size_);
    for (jint i = depth, end = newNodes->size_; i < end; i++) {
      IOSObjectArray_SetAndConsume(newNodes, i, new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init());
    }
    JreStrongAssign(&self->nodes_, newNodes);
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)

@implementation OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (void)resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a
                                                    withInt:(jint)state {
  JreAssert([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumTransitionsWithInt:state] != 0, @"org/apache/lucene/util/automaton/FiniteStringsIterator.java:190 condition failed: assert a.getNumTransitions(state) != 0;");
  self->state_ = state;
  transition_ = 0;
  [a getTransitionWithInt:state withInt:0 withOrgApacheLuceneUtilAutomatonTransition:t_];
  label_ = ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(t_))->min_;
  to_ = t_->dest_;
}

- (jint)nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a {
  if (label_ > ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(t_))->max_) {
    transition_++;
    if (transition_ >= [((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumTransitionsWithInt:state_]) {
      label_ = -1;
      return -1;
    }
    [a getTransitionWithInt:state_ withInt:transition_ withOrgApacheLuceneUtilAutomatonTransition:t_];
    label_ = t_->min_;
    to_ = t_->dest_;
  }
  return label_++;
}

- (void)dealloc {
  RELEASE_(t_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 0, 1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 2, 3, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:withInt:);
  methods[2].selector = @selector(nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "state_", "I", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "to_", "I", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "transition_", "I", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "label_", "I", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "t_", "LOrgApacheLuceneUtilAutomatonTransition;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "resetState", "LOrgApacheLuceneUtilAutomatonAutomaton;I", "nextLabel", "LOrgApacheLuceneUtilAutomatonAutomaton;", "LOrgApacheLuceneUtilAutomatonFiniteStringsIterator;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode = { "PathNode", "org.apache.lucene.util.automaton", ptrTable, methods, fields, 7, 0xa, 3, 5, 4, -1, -1, -1, -1 };
  return &_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode;
}

@end

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *self) {
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->t_, new_OrgApacheLuceneUtilAutomatonTransition_init());
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, init)
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)
