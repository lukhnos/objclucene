//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/index/UpgradeIndexMergePolicy.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/lang/Boolean.h"
#include "java/util/ArrayList.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/apache/lucene/index/IndexWriter.h"
#include "org/apache/lucene/index/MergePolicy.h"
#include "org/apache/lucene/index/MergeTrigger.h"
#include "org/apache/lucene/index/SegmentCommitInfo.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentInfos.h"
#include "org/apache/lucene/index/UpgradeIndexMergePolicy.h"
#include "org/apache/lucene/util/InfoStream.h"
#include "org/apache/lucene/util/Version.h"

#if __has_feature(objc_arc)
#error "org/apache/lucene/index/UpgradeIndexMergePolicy must not be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgApacheLuceneIndexUpgradeIndexMergePolicy ()

- (jboolean)verboseWithOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer;

- (void)messageWithNSString:(NSString *)message
withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer;

@end

__attribute__((unused)) static jboolean OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexIndexWriter *writer);

__attribute__((unused)) static void OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, NSString *message, OrgApacheLuceneIndexIndexWriter *writer);

@implementation OrgApacheLuceneIndexUpgradeIndexMergePolicy

- (instancetype)initWithOrgApacheLuceneIndexMergePolicy:(OrgApacheLuceneIndexMergePolicy *)base {
  OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(self, base);
  return self;
}

- (jboolean)shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)si {
  return ![((OrgApacheLuceneUtilVersion *) nil_chk(JreLoadStatic(OrgApacheLuceneUtilVersion, LATEST))) isEqual:[((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentCommitInfo *) nil_chk(si))->info_)) getVersion]];
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findMergesWithOrgApacheLuceneIndexMergeTrigger:(OrgApacheLuceneIndexMergeTrigger *)mergeTrigger
                                                                  withOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                   withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findMergesWithOrgApacheLuceneIndexMergeTrigger:nil withOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer];
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                                     withInt:(jint)maxSegmentCount
                                                                                             withJavaUtilMap:(id<JavaUtilMap>)segmentsToMerge
                                                                         withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  id<JavaUtilMap> oldSegments = create_JavaUtilHashMap_init();
  for (OrgApacheLuceneIndexSegmentCommitInfo * __strong si in nil_chk(segmentInfos)) {
    JavaLangBoolean *v = [((id<JavaUtilMap>) nil_chk(segmentsToMerge)) getWithId:si];
    if (v != nil && [self shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:si]) {
      [oldSegments putWithId:si withId:v];
    }
  }
  if (OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer)) {
    OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, JreStrcat("$@", @"findForcedMerges: segmentsToUpgrade=", oldSegments), writer);
  }
  if ([oldSegments isEmpty]) return nil;
  OrgApacheLuceneIndexMergePolicy_MergeSpecification *spec = JreRetainedLocalValue([((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withInt:maxSegmentCount withJavaUtilMap:oldSegments withOrgApacheLuceneIndexIndexWriter:writer]);
  if (spec != nil) {
    for (OrgApacheLuceneIndexMergePolicy_OneMerge * __strong om in nil_chk(spec->merges_)) {
      [((id<JavaUtilSet>) nil_chk([oldSegments keySet])) removeAllWithJavaUtilCollection:((OrgApacheLuceneIndexMergePolicy_OneMerge *) nil_chk(om))->segments_];
    }
  }
  if (![oldSegments isEmpty]) {
    if (OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer)) {
      OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, JreStrcat("$$$@", @"findForcedMerges: ", [[base_ java_getClass] getSimpleName], @" does not want to merge all old segments, merge remaining ones into new segment: ", oldSegments), writer);
    }
    id<JavaUtilList> newInfos = create_JavaUtilArrayList_init();
    for (OrgApacheLuceneIndexSegmentCommitInfo * __strong si in segmentInfos) {
      if ([oldSegments containsKeyWithId:si]) {
        [newInfos addWithId:si];
      }
    }
    if (spec == nil) {
      spec = create_OrgApacheLuceneIndexMergePolicy_MergeSpecification_init();
    }
    [spec addWithOrgApacheLuceneIndexMergePolicy_OneMerge:create_OrgApacheLuceneIndexMergePolicy_OneMerge_initWithJavaUtilList_(newInfos)];
  }
  return spec;
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer];
}

- (jboolean)useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segments
                      withOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)newSegment
                            withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:segments withOrgApacheLuceneIndexSegmentCommitInfo:newSegment withOrgApacheLuceneIndexIndexWriter:writer];
}

- (NSString *)description {
  return JreStrcat("C$$@C", '[', [[self java_getClass] getSimpleName], @"->", base_, ']');
}

- (jboolean)verboseWithOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer);
}

- (void)messageWithNSString:(NSString *)message
withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, message, writer);
}

- (void)dealloc {
  RELEASE_(base_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x4, 1, 2, -1, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneIndexMergePolicy_MergeSpecification;", 0x1, 3, 4, 5, -1, -1, -1 },
    { NULL, "LOrgApacheLuceneIndexMergePolicy_MergeSpecification;", 0x1, 6, 7, 5, 8, -1, -1 },
    { NULL, "LOrgApacheLuceneIndexMergePolicy_MergeSpecification;", 0x1, 9, 10, 5, -1, -1, -1 },
    { NULL, "Z", 0x1, 11, 12, 5, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 13, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 14, 15, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 16, 17, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgApacheLuceneIndexMergePolicy:);
  methods[1].selector = @selector(shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:);
  methods[2].selector = @selector(findMergesWithOrgApacheLuceneIndexMergeTrigger:withOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:);
  methods[3].selector = @selector(findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:withInt:withJavaUtilMap:withOrgApacheLuceneIndexIndexWriter:);
  methods[4].selector = @selector(findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:);
  methods[5].selector = @selector(useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexSegmentCommitInfo:withOrgApacheLuceneIndexIndexWriter:);
  methods[6].selector = @selector(description);
  methods[7].selector = @selector(verboseWithOrgApacheLuceneIndexIndexWriter:);
  methods[8].selector = @selector(messageWithNSString:withOrgApacheLuceneIndexIndexWriter:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "base_", "LOrgApacheLuceneIndexMergePolicy;", .constantValue.asLong = 0, 0x14, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneIndexMergePolicy;", "shouldUpgradeSegment", "LOrgApacheLuceneIndexSegmentCommitInfo;", "findMerges", "LOrgApacheLuceneIndexMergeTrigger;LOrgApacheLuceneIndexSegmentInfos;LOrgApacheLuceneIndexIndexWriter;", "LJavaIoIOException;", "findForcedMerges", "LOrgApacheLuceneIndexSegmentInfos;ILJavaUtilMap;LOrgApacheLuceneIndexIndexWriter;", "(Lorg/apache/lucene/index/SegmentInfos;ILjava/util/Map<Lorg/apache/lucene/index/SegmentCommitInfo;Ljava/lang/Boolean;>;Lorg/apache/lucene/index/IndexWriter;)Lorg/apache/lucene/index/MergePolicy$MergeSpecification;", "findForcedDeletesMerges", "LOrgApacheLuceneIndexSegmentInfos;LOrgApacheLuceneIndexIndexWriter;", "useCompoundFile", "LOrgApacheLuceneIndexSegmentInfos;LOrgApacheLuceneIndexSegmentCommitInfo;LOrgApacheLuceneIndexIndexWriter;", "toString", "verbose", "LOrgApacheLuceneIndexIndexWriter;", "message", "LNSString;LOrgApacheLuceneIndexIndexWriter;" };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexUpgradeIndexMergePolicy = { "UpgradeIndexMergePolicy", "org.apache.lucene.index", ptrTable, methods, fields, 7, 0x1, 9, 1, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneIndexUpgradeIndexMergePolicy;
}

@end

void OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexMergePolicy *base) {
  OrgApacheLuceneIndexMergePolicy_init(self);
  JreStrongAssign(&self->base_, base);
}

OrgApacheLuceneIndexUpgradeIndexMergePolicy *new_OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexMergePolicy *base) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneIndexUpgradeIndexMergePolicy, initWithOrgApacheLuceneIndexMergePolicy_, base)
}

OrgApacheLuceneIndexUpgradeIndexMergePolicy *create_OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexMergePolicy *base) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneIndexUpgradeIndexMergePolicy, initWithOrgApacheLuceneIndexMergePolicy_, base)
}

jboolean OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexIndexWriter *writer) {
  return writer != nil && [((OrgApacheLuceneUtilInfoStream *) nil_chk(writer->infoStream_)) isEnabledWithNSString:@"UPGMP"];
}

void OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, NSString *message, OrgApacheLuceneIndexIndexWriter *writer) {
  [((OrgApacheLuceneUtilInfoStream *) nil_chk(((OrgApacheLuceneIndexIndexWriter *) nil_chk(writer))->infoStream_)) messageWithNSString:@"UPGMP" withNSString:message];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexUpgradeIndexMergePolicy)
