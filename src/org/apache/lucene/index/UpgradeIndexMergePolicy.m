//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/index/UpgradeIndexMergePolicy.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Boolean.h"
#include "java/util/ArrayList.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/apache/lucene/index/IndexWriter.h"
#include "org/apache/lucene/index/MergePolicy.h"
#include "org/apache/lucene/index/MergeTrigger.h"
#include "org/apache/lucene/index/SegmentCommitInfo.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentInfos.h"
#include "org/apache/lucene/index/UpgradeIndexMergePolicy.h"
#include "org/apache/lucene/util/InfoStream.h"
#include "org/apache/lucene/util/Version.h"

@interface OrgApacheLuceneIndexUpgradeIndexMergePolicy ()

- (jboolean)verboseWithOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer;

- (void)messageWithNSString:(NSString *)message
withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer;

@end

__attribute__((unused)) static jboolean OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexIndexWriter *writer);

__attribute__((unused)) static void OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, NSString *message, OrgApacheLuceneIndexIndexWriter *writer);

@implementation OrgApacheLuceneIndexUpgradeIndexMergePolicy

- (instancetype)initWithOrgApacheLuceneIndexMergePolicy:(OrgApacheLuceneIndexMergePolicy *)base {
  OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(self, base);
  return self;
}

- (jboolean)shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)si {
  return ![((OrgApacheLuceneUtilVersion *) nil_chk(JreLoadStatic(OrgApacheLuceneUtilVersion, LATEST))) isEqual:[((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentCommitInfo *) nil_chk(si))->info_)) getVersion]];
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findMergesWithOrgApacheLuceneIndexMergeTrigger:(OrgApacheLuceneIndexMergeTrigger *)mergeTrigger
                                                                  withOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                   withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findMergesWithOrgApacheLuceneIndexMergeTrigger:nil withOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer];
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                                     withInt:(jint)maxSegmentCount
                                                                                             withJavaUtilMap:(id<JavaUtilMap>)segmentsToMerge
                                                                         withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  id<JavaUtilMap> oldSegments = create_JavaUtilHashMap_init();
  for (OrgApacheLuceneIndexSegmentCommitInfo * __strong si in nil_chk(segmentInfos)) {
    JavaLangBoolean *v = [((id<JavaUtilMap>) nil_chk(segmentsToMerge)) getWithId:si];
    if (v != nil && [self shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:si]) {
      [oldSegments putWithId:si withId:v];
    }
  }
  if (OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer)) {
    OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, JreStrcat("$@", @"findForcedMerges: segmentsToUpgrade=", oldSegments), writer);
  }
  if ([oldSegments isEmpty]) return nil;
  OrgApacheLuceneIndexMergePolicy_MergeSpecification *spec = [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withInt:maxSegmentCount withJavaUtilMap:oldSegments withOrgApacheLuceneIndexIndexWriter:writer];
  if (spec != nil) {
    for (OrgApacheLuceneIndexMergePolicy_OneMerge * __strong om in nil_chk(spec->merges_)) {
      [((id<JavaUtilSet>) nil_chk([oldSegments keySet])) removeAllWithJavaUtilCollection:((OrgApacheLuceneIndexMergePolicy_OneMerge *) nil_chk(om))->segments_];
    }
  }
  if (![oldSegments isEmpty]) {
    if (OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer)) {
      OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, JreStrcat("$$$@", @"findForcedMerges: ", [[base_ getClass] getSimpleName], @" does not want to merge all old segments, merge remaining ones into new segment: ", oldSegments), writer);
    }
    id<JavaUtilList> newInfos = create_JavaUtilArrayList_init();
    for (OrgApacheLuceneIndexSegmentCommitInfo * __strong si in segmentInfos) {
      if ([oldSegments containsKeyWithId:si]) {
        [newInfos addWithId:si];
      }
    }
    if (spec == nil) {
      spec = create_OrgApacheLuceneIndexMergePolicy_MergeSpecification_init();
    }
    [spec addWithOrgApacheLuceneIndexMergePolicy_OneMerge:create_OrgApacheLuceneIndexMergePolicy_OneMerge_initWithJavaUtilList_(newInfos)];
  }
  return spec;
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer];
}

- (jboolean)useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segments
                      withOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)newSegment
                            withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(base_)) useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:segments withOrgApacheLuceneIndexSegmentCommitInfo:newSegment withOrgApacheLuceneIndexIndexWriter:writer];
}

- (NSString *)description {
  return JreStrcat("C$$@C", '[', [[self getClass] getSimpleName], @"->", base_, ']');
}

- (jboolean)verboseWithOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(self, writer);
}

- (void)messageWithNSString:(NSString *)message
withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(self, message, writer);
}

- (void)dealloc {
  RELEASE_(base_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexMergePolicy:", "UpgradeIndexMergePolicy", NULL, 0x1, NULL, NULL },
    { "shouldUpgradeSegmentWithOrgApacheLuceneIndexSegmentCommitInfo:", "shouldUpgradeSegment", "Z", 0x4, NULL, NULL },
    { "findMergesWithOrgApacheLuceneIndexMergeTrigger:withOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:", "findMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", NULL },
    { "findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:withInt:withJavaUtilMap:withOrgApacheLuceneIndexIndexWriter:", "findForcedMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", "(Lorg/apache/lucene/index/SegmentInfos;ILjava/util/Map<Lorg/apache/lucene/index/SegmentCommitInfo;Ljava/lang/Boolean;>;Lorg/apache/lucene/index/IndexWriter;)Lorg/apache/lucene/index/MergePolicy$MergeSpecification;" },
    { "findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:", "findForcedDeletesMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", NULL },
    { "useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexSegmentCommitInfo:withOrgApacheLuceneIndexIndexWriter:", "useCompoundFile", "Z", 0x1, "Ljava.io.IOException;", NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "verboseWithOrgApacheLuceneIndexIndexWriter:", "verbose", "Z", 0x2, NULL, NULL },
    { "messageWithNSString:withOrgApacheLuceneIndexIndexWriter:", "message", "V", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "base_", NULL, 0x14, "Lorg.apache.lucene.index.MergePolicy;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexUpgradeIndexMergePolicy = { 2, "UpgradeIndexMergePolicy", "org.apache.lucene.index", NULL, 0x1, 9, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneIndexUpgradeIndexMergePolicy;
}

@end

void OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexMergePolicy *base) {
  OrgApacheLuceneIndexMergePolicy_init(self);
  JreStrongAssign(&self->base_, base);
}

OrgApacheLuceneIndexUpgradeIndexMergePolicy *new_OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexMergePolicy *base) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneIndexUpgradeIndexMergePolicy, initWithOrgApacheLuceneIndexMergePolicy_, base)
}

OrgApacheLuceneIndexUpgradeIndexMergePolicy *create_OrgApacheLuceneIndexUpgradeIndexMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_(OrgApacheLuceneIndexMergePolicy *base) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneIndexUpgradeIndexMergePolicy, initWithOrgApacheLuceneIndexMergePolicy_, base)
}

jboolean OrgApacheLuceneIndexUpgradeIndexMergePolicy_verboseWithOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, OrgApacheLuceneIndexIndexWriter *writer) {
  return writer != nil && [((OrgApacheLuceneUtilInfoStream *) nil_chk(writer->infoStream_)) isEnabledWithNSString:@"UPGMP"];
}

void OrgApacheLuceneIndexUpgradeIndexMergePolicy_messageWithNSString_withOrgApacheLuceneIndexIndexWriter_(OrgApacheLuceneIndexUpgradeIndexMergePolicy *self, NSString *message, OrgApacheLuceneIndexIndexWriter *writer) {
  [((OrgApacheLuceneUtilInfoStream *) nil_chk(((OrgApacheLuceneIndexIndexWriter *) nil_chk(writer))->infoStream_)) messageWithNSString:@"UPGMP" withNSString:message];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexUpgradeIndexMergePolicy)
